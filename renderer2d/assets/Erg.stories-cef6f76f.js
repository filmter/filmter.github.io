import{a as M,g as Wt,b as _,i as wt,d as Y,u as Qs,e as ks,s as Dt,w as q,n as k,o as Mt,t as js,f as xe,v as ys,j as b,k as T,l as A,F as jt,m as P,p as u,q as At,x as F,y as K,z as L,A as Ot,B as de,C as S,D as Is,N as tr,E as vt,G as st,H as De,I as ze,J as er,K as sr,L as rr,r as gs,M as or,O as He,P as Ke,Q as ir}from"./vue.esm-bundler-6f0914dd.js";import{i as Kt,g as ar,e as nr,a as ps,b as lr,c as hr,S as se,d as me,f as xs,h as fs,o as dr,k as ms,r as cr,j as vs,s as ur,l as yr,U as Ve,m as ve,n as we,p as re,q as ws,t as gr,u as pr,v as xr,w as be,x as bs,y as fr,z as Bs,A as mr,B as vr,C as wr,D as We,E as br,F as ne,G as Ps,H as bt,I as Ue,J as Br,K as Nt,L as Fs,M as Ns,N as Ms,O as Ts,P as lt,V as Pr,Q as Fr,R as Nr,T as It,W as Mr,X as oe,Y as ct,Z as Tr,_ as gt,$ as Cs,a0 as Cr,a1 as Be,a2 as qe,a3 as Sr,a4 as Rr,a5 as Er,a6 as H,a7 as Lr,a8 as _r,a9 as Ar,aa as $r,ab as pt,ac as X,ad as Bt,ae as Dr,af as ce,ag as zr,ah as Hr,ai as Kr,aj as ue,ak as Vr,al as Wr,am as Ur,an as qr,ao as ot,ap as Xr}from"./index-07e7ad5e.js";const Pe=a=>{let t,s;return a.type==="touchend"?(s=a.changedTouches[0].clientY,t=a.changedTouches[0].clientX):a.type.startsWith("touch")?(s=a.touches[0].clientY,t=a.touches[0].clientX):(s=a.clientY,t=a.clientX),{clientX:t,clientY:s}};function Yr(a){return a}var Xe=Object.create,Gr=function(){function a(){}return function(t){if(!Kt(t))return{};if(Xe)return Xe(t);a.prototype=t;var s=new a;return a.prototype=void 0,s}}();const Jr=Gr;function Zr(a,t,s){switch(s.length){case 0:return a.call(t);case 1:return a.call(t,s[0]);case 2:return a.call(t,s[0],s[1]);case 3:return a.call(t,s[0],s[1],s[2])}return a.apply(t,s)}function Or(a,t){var s=-1,e=a.length;for(t||(t=Array(e));++s<e;)t[s]=a[s];return t}var Qr=800,kr=16,jr=Date.now;function Ir(a){var t=0,s=0;return function(){var e=jr(),i=kr-(e-s);if(s=e,i>0){if(++t>=Qr)return arguments[0]}else t=0;return a.apply(void 0,arguments)}}function to(a){return function(){return a}}var eo=function(){try{var a=ar(Object,"defineProperty");return a({},"",{}),a}catch{}}();const ie=eo;var so=ie?function(a,t){return ie(a,"toString",{configurable:!0,enumerable:!1,value:to(t),writable:!0})}:Yr;const ro=so;var oo=Ir(ro);const io=oo;function ao(a,t){for(var s=-1,e=a==null?0:a.length;++s<e&&t(a[s],s,a)!==!1;);return a}function Ss(a,t,s){t=="__proto__"&&ie?ie(a,t,{configurable:!0,enumerable:!0,value:s,writable:!0}):a[t]=s}var no=Object.prototype,lo=no.hasOwnProperty;function Fe(a,t,s){var e=a[t];(!(lo.call(a,t)&&nr(e,s))||s===void 0&&!(t in a))&&Ss(a,t,s)}function le(a,t,s,e){var i=!s;s||(s={});for(var o=-1,r=t.length;++o<r;){var n=t[o],l=e?e(s[n],a[n],n,s,a):void 0;l===void 0&&(l=a[n]),i?Ss(s,n,l):Fe(s,n,l)}return s}var Ye=Math.max;function ho(a,t,s){return t=Ye(t===void 0?a.length-1:t,0),function(){for(var e=arguments,i=-1,o=Ye(e.length-t,0),r=Array(o);++i<o;)r[i]=e[t+i];i=-1;for(var n=Array(t+1);++i<t;)n[i]=e[i];return n[t]=s(r),Zr(a,this,n)}}function co(a){var t=[];if(a!=null)for(var s in Object(a))t.push(s);return t}var uo=Object.prototype,yo=uo.hasOwnProperty;function go(a){if(!Kt(a))return co(a);var t=ps(a),s=[];for(var e in a)e=="constructor"&&(t||!yo.call(a,e))||s.push(e);return s}function Ne(a){return lr(a)?hr(a,!0):go(a)}var Ge=se?se.isConcatSpreadable:void 0;function po(a){return me(a)||xs(a)||!!(Ge&&a&&a[Ge])}function Rs(a,t,s,e,i){var o=-1,r=a.length;for(s||(s=po),i||(i=[]);++o<r;){var n=a[o];t>0&&s(n)?t>1?Rs(n,t-1,s,e,i):fs(i,n):e||(i[i.length]=n)}return i}function xo(a){var t=a==null?0:a.length;return t?Rs(a,1):[]}function fo(a){return io(ho(a,void 0,xo),a+"")}var mo=dr(Object.getPrototypeOf,Object);const Es=mo;function vo(a,t){return a&&le(t,ms(t),a)}function wo(a,t){return a&&le(t,Ne(t),a)}var Ls=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Je=Ls&&typeof module=="object"&&module&&!module.nodeType&&module,bo=Je&&Je.exports===Ls,Ze=bo?cr.Buffer:void 0,Oe=Ze?Ze.allocUnsafe:void 0;function Bo(a,t){if(t)return a.slice();var s=a.length,e=Oe?Oe(s):new a.constructor(s);return a.copy(e),e}function Po(a,t){return le(a,vs(a),t)}var Fo=Object.getOwnPropertySymbols,No=Fo?function(a){for(var t=[];a;)fs(t,vs(a)),a=Es(a);return t}:ur;const _s=No;function Mo(a,t){return le(a,_s(a),t)}function To(a){return yr(a,Ne,_s)}var Co=Object.prototype,So=Co.hasOwnProperty;function Ro(a){var t=a.length,s=new a.constructor(t);return t&&typeof a[0]=="string"&&So.call(a,"index")&&(s.index=a.index,s.input=a.input),s}function Me(a){var t=new a.constructor(a.byteLength);return new Ve(t).set(new Ve(a)),t}function Eo(a,t){var s=t?Me(a.buffer):a.buffer;return new a.constructor(s,a.byteOffset,a.byteLength)}var Lo=/\w*$/;function _o(a){var t=new a.constructor(a.source,Lo.exec(a));return t.lastIndex=a.lastIndex,t}var Qe=se?se.prototype:void 0,ke=Qe?Qe.valueOf:void 0;function Ao(a){return ke?Object(ke.call(a)):{}}function $o(a,t){var s=t?Me(a.buffer):a.buffer;return new a.constructor(s,a.byteOffset,a.length)}var Do="[object Boolean]",zo="[object Date]",Ho="[object Map]",Ko="[object Number]",Vo="[object RegExp]",Wo="[object Set]",Uo="[object String]",qo="[object Symbol]",Xo="[object ArrayBuffer]",Yo="[object DataView]",Go="[object Float32Array]",Jo="[object Float64Array]",Zo="[object Int8Array]",Oo="[object Int16Array]",Qo="[object Int32Array]",ko="[object Uint8Array]",jo="[object Uint8ClampedArray]",Io="[object Uint16Array]",ti="[object Uint32Array]";function ei(a,t,s){var e=a.constructor;switch(t){case Xo:return Me(a);case Do:case zo:return new e(+a);case Yo:return Eo(a,s);case Go:case Jo:case Zo:case Oo:case Qo:case ko:case jo:case Io:case ti:return $o(a,s);case Ho:return new e;case Ko:case Uo:return new e(a);case Vo:return _o(a);case Wo:return new e;case qo:return Ao(a)}}function si(a){return typeof a.constructor=="function"&&!ps(a)?Jr(Es(a)):{}}var ri="[object Map]";function oi(a){return ve(a)&&we(a)==ri}var je=re&&re.isMap,ii=je?ws(je):oi;const ai=ii;var ni="[object Set]";function li(a){return ve(a)&&we(a)==ni}var Ie=re&&re.isSet,hi=Ie?ws(Ie):li;const di=hi;var ci=1,ui=2,yi=4,As="[object Arguments]",gi="[object Array]",pi="[object Boolean]",xi="[object Date]",fi="[object Error]",$s="[object Function]",mi="[object GeneratorFunction]",vi="[object Map]",wi="[object Number]",Ds="[object Object]",bi="[object RegExp]",Bi="[object Set]",Pi="[object String]",Fi="[object Symbol]",Ni="[object WeakMap]",Mi="[object ArrayBuffer]",Ti="[object DataView]",Ci="[object Float32Array]",Si="[object Float64Array]",Ri="[object Int8Array]",Ei="[object Int16Array]",Li="[object Int32Array]",_i="[object Uint8Array]",Ai="[object Uint8ClampedArray]",$i="[object Uint16Array]",Di="[object Uint32Array]",R={};R[As]=R[gi]=R[Mi]=R[Ti]=R[pi]=R[xi]=R[Ci]=R[Si]=R[Ri]=R[Ei]=R[Li]=R[vi]=R[wi]=R[Ds]=R[bi]=R[Bi]=R[Pi]=R[Fi]=R[_i]=R[Ai]=R[$i]=R[Di]=!0;R[fi]=R[$s]=R[Ni]=!1;function te(a,t,s,e,i,o){var r,n=t&ci,l=t&ui,d=t&yi;if(s&&(r=i?s(a,e,i,o):s(a)),r!==void 0)return r;if(!Kt(a))return a;var c=me(a);if(c){if(r=Ro(a),!n)return Or(a,r)}else{var h=we(a),y=h==$s||h==mi;if(gr(a))return Bo(a,n);if(h==Ds||h==As||y&&!i){if(r=l||y?{}:si(a),!n)return l?Mo(a,wo(r,a)):Po(a,vo(r,a))}else{if(!R[h])return i?a:{};r=ei(a,h,n)}}o||(o=new pr);var p=o.get(a);if(p)return p;o.set(a,r),di(a)?a.forEach(function(g){r.add(te(g,t,s,g,a,o))}):ai(a)&&a.forEach(function(g,v){r.set(v,te(g,t,s,v,a,o))});var f=d?l?To:xr:l?Ne:ms,x=c?void 0:f(a);return ao(x||a,function(g,v){x&&(v=g,g=a[v]),Fe(r,v,te(g,t,s,v,a,o))}),r}var zi=1,Hi=4;function ts(a){return te(a,zi|Hi)}function Ki(a,t){return a!=null&&t in Object(a)}function Vi(a,t,s){t=be(t,a);for(var e=-1,i=t.length,o=!1;++e<i;){var r=bs(t[e]);if(!(o=a!=null&&s(a,r)))break;a=a[r]}return o||++e!=i?o:(i=a==null?0:a.length,!!i&&fr(i)&&Bs(r,i)&&(me(a)||xs(a)))}function Wi(a,t){return a!=null&&Vi(a,t,Ki)}var Ui="[object Boolean]";function $t(a){return a===!0||a===!1||ve(a)&&mr(a)==Ui}function qi(a,t,s,e){if(!Kt(a))return a;t=be(t,a);for(var i=-1,o=t.length,r=o-1,n=a;n!=null&&++i<o;){var l=bs(t[i]),d=s;if(l==="__proto__"||l==="constructor"||l==="prototype")return a;if(i!=r){var c=n[l];d=e?e(c,l,n):void 0,d===void 0&&(d=Kt(c)?c:Bs(t[i+1])?[]:{})}Fe(n,l,d),n=n[l]}return a}function Xi(a,t,s){for(var e=-1,i=t.length,o={};++e<i;){var r=t[e],n=vr(a,r);s(n,r)&&qi(o,be(r,a),n)}return o}function Yi(a,t){return Xi(a,t,function(s,e){return Wi(a,e)})}var Gi=fo(function(a,t){return a==null?{}:Yi(a,t)});const es=Gi,Ji=["class","style"],Zi=/^on[A-Z]/,Oi=(a={})=>{const{excludeListeners:t=!1,excludeKeys:s}=a,e=M(()=>((s==null?void 0:s.value)||[]).concat(Ji)),i=Wt();return i?M(()=>{var o;return wr(Object.entries((o=i.proxy)==null?void 0:o.$attrs).filter(([r])=>!e.value.includes(r)&&!(t&&Zi.test(r))))}):M(()=>({}))};function Qi(a){const t=_();function s(){if(a.value==null)return;const{selectionStart:i,selectionEnd:o,value:r}=a.value;if(i==null||o==null)return;const n=r.slice(0,Math.max(0,i)),l=r.slice(Math.max(0,o));t.value={selectionStart:i,selectionEnd:o,value:r,beforeTxt:n,afterTxt:l}}function e(){if(a.value==null||t.value==null)return;const{value:i}=a.value,{beforeTxt:o,afterTxt:r,selectionStart:n}=t.value;if(o==null||r==null||n==null)return;let l=i.length;if(i.endsWith(r))l=i.length-r.length;else if(i.startsWith(o))l=o.length;else{const d=o[n-1],c=i.indexOf(d,n-1);c!==-1&&(l=c+1)}a.value.setSelectionRange(l,l)}return[s,e]}let J;const ki=`
  height:0 !important;
  visibility:hidden !important;
  ${br()?"":"overflow:hidden !important;"}
  position:absolute !important;
  z-index:-1000 !important;
  top:0 !important;
  right:0 !important;
`,ji=["letter-spacing","line-height","padding-top","padding-bottom","font-family","font-weight","font-size","text-rendering","text-transform","width","text-indent","padding-left","padding-right","border-width","box-sizing"];function Ii(a){const t=window.getComputedStyle(a),s=t.getPropertyValue("box-sizing"),e=Number.parseFloat(t.getPropertyValue("padding-bottom"))+Number.parseFloat(t.getPropertyValue("padding-top")),i=Number.parseFloat(t.getPropertyValue("border-bottom-width"))+Number.parseFloat(t.getPropertyValue("border-top-width"));return{contextStyle:ji.map(r=>`${r}:${t.getPropertyValue(r)}`).join(";"),paddingSize:e,borderSize:i,boxSizing:s}}function ss(a,t=1,s){var e;J||(J=document.createElement("textarea"),document.body.appendChild(J));const{paddingSize:i,borderSize:o,boxSizing:r,contextStyle:n}=Ii(a);J.setAttribute("style",`${n};${ki}`),J.value=a.value||a.placeholder||"";let l=J.scrollHeight;const d={};r==="border-box"?l=l+o:r==="content-box"&&(l=l-i),J.value="";const c=J.scrollHeight-i;if(We(t)){let h=c*t;r==="border-box"&&(h=h+i+o),l=Math.max(h,l),d.minHeight=`${h}px`}if(We(s)){let h=c*s;r==="border-box"&&(h=h+i+o),l=Math.min(h,l)}return d.height=`${l}px`,(e=J.parentNode)==null||e.removeChild(J),J=void 0,d}const ta=ne({id:{type:String,default:void 0},size:Ps,disabled:Boolean,modelValue:{type:bt([String,Number,Object]),default:""},type:{type:String,default:"text"},resize:{type:String,values:["none","both","horizontal","vertical"]},autosize:{type:bt([Boolean,Object]),default:!1},autocomplete:{type:String,default:"off"},formatter:{type:Function},parser:{type:Function},placeholder:{type:String},form:{type:String},readonly:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},showPassword:{type:Boolean,default:!1},showWordLimit:{type:Boolean,default:!1},suffixIcon:{type:Ue},prefixIcon:{type:Ue},containerRole:{type:String,default:void 0},label:{type:String,default:void 0},tabindex:{type:[String,Number],default:0},validateEvent:{type:Boolean,default:!0},inputStyle:{type:bt([Object,Array,String]),default:()=>Br({})}}),ea={[Nt]:a=>wt(a),input:a=>wt(a),change:a=>wt(a),focus:a=>a instanceof FocusEvent,blur:a=>a instanceof FocusEvent,clear:()=>!0,mouseleave:a=>a instanceof MouseEvent,mouseenter:a=>a instanceof MouseEvent,keydown:a=>a instanceof Event,compositionstart:a=>a instanceof CompositionEvent,compositionupdate:a=>a instanceof CompositionEvent,compositionend:a=>a instanceof CompositionEvent},sa=["role"],ra=["id","type","disabled","formatter","parser","readonly","autocomplete","tabindex","aria-label","placeholder","form"],oa=["id","tabindex","disabled","readonly","autocomplete","aria-label","placeholder","form"],ia=Y({name:"ElInput",inheritAttrs:!1}),aa=Y({...ia,props:ta,emits:ea,setup(a,{expose:t,emit:s}){const e=a,i=Qs(),o=ks(),r=M(()=>{const m={};return e.containerRole==="combobox"&&(m["aria-haspopup"]=i["aria-haspopup"],m["aria-owns"]=i["aria-owns"],m["aria-expanded"]=i["aria-expanded"]),m}),n=M(()=>[e.type==="textarea"?g.b():x.b(),x.m(p.value),x.is("disabled",f.value),x.is("exceed",I.value),{[x.b("group")]:o.prepend||o.append,[x.bm("group","append")]:o.append,[x.bm("group","prepend")]:o.prepend,[x.m("prefix")]:o.prefix||e.prefixIcon,[x.m("suffix")]:o.suffix||e.suffixIcon||e.clearable||e.showPassword,[x.bm("suffix","password-clear")]:mt.value&&Rt.value},i.class]),l=M(()=>[x.e("wrapper"),x.is("focus",B.value)]),d=Oi({excludeKeys:M(()=>Object.keys(r.value))}),{form:c,formItem:h}=Fs(),{inputId:y}=Ns(e,{formItemContext:h}),p=Ms(),f=Ts(),x=lt("input"),g=lt("textarea"),v=Dt(),w=Dt(),B=_(!1),rt=_(!1),j=_(!1),xt=_(!1),Ut=_(),ft=Dt(e.inputStyle),ht=M(()=>v.value||w.value),Tt=M(()=>{var m;return(m=c==null?void 0:c.statusIcon)!=null?m:!1}),O=M(()=>(h==null?void 0:h.validateState)||""),qt=M(()=>O.value&&Pr[O.value]),Xt=M(()=>xt.value?Fr:Nr),Ct=M(()=>[i.style,e.inputStyle]),St=M(()=>[e.inputStyle,ft.value,{resize:e.resize}]),G=M(()=>It(e.modelValue)?"":String(e.modelValue)),mt=M(()=>e.clearable&&!f.value&&!e.readonly&&!!G.value&&(B.value||rt.value)),Rt=M(()=>e.showPassword&&!f.value&&!e.readonly&&!!G.value&&(!!G.value||B.value)),N=M(()=>e.showWordLimit&&!!d.value.maxlength&&(e.type==="text"||e.type==="textarea")&&!f.value&&!e.readonly&&!e.showPassword),V=M(()=>G.value.length),I=M(()=>!!N.value&&V.value>Number(d.value.maxlength)),Yt=M(()=>!!o.suffix||!!e.suffixIcon||mt.value||e.showPassword||N.value||!!O.value&&Tt.value),[Gt,qs]=Qi(v);Mr(w,m=>{if(Xs(),!N.value||e.resize!=="both")return;const C=m[0],{width:Q}=C.contentRect;Ut.value={right:`calc(100% - ${Q+15+6}px)`}});const Et=()=>{const{type:m,autosize:C}=e;if(!(!Cs||m!=="textarea"||!w.value))if(C){const Q=De(C)?C.minRows:void 0,Zt=De(C)?C.maxRows:void 0,$e=ss(w.value,Q,Zt);ft.value={overflowY:"hidden",...$e},k(()=>{w.value.offsetHeight,ft.value=$e})}else ft.value={minHeight:ss(w.value).minHeight}},Xs=(m=>{let C=!1;return()=>{var Q;if(C||!e.autosize)return;((Q=w.value)==null?void 0:Q.offsetParent)===null||(m(),C=!0)}})(Et),Lt=()=>{const m=ht.value;!m||m.value===G.value||(m.value=G.value)},he=async m=>{Gt();let{value:C}=m.target;if(e.formatter&&(C=e.parser?e.parser(C):C,C=e.formatter(C)),!j.value){if(C===G.value){Lt();return}s(Nt,C),s("input",C),await k(),Lt(),qs()}},Te=m=>{s("change",m.target.value)},Ce=m=>{s("compositionstart",m),j.value=!0},Se=m=>{var C;s("compositionupdate",m);const Q=(C=m.target)==null?void 0:C.value,Zt=Q[Q.length-1]||"";j.value=!Cr(Zt)},Re=m=>{s("compositionend",m),j.value&&(j.value=!1,he(m))},Ys=()=>{xt.value=!xt.value,Jt()},Jt=async()=>{var m;await k(),(m=ht.value)==null||m.focus()},Gs=()=>{var m;return(m=ht.value)==null?void 0:m.blur()},Ee=m=>{B.value=!0,s("focus",m)},Le=m=>{var C;B.value=!1,s("blur",m),e.validateEvent&&((C=h==null?void 0:h.validate)==null||C.call(h,"blur").catch(Q=>oe()))},Js=m=>{rt.value=!1,s("mouseleave",m)},Zs=m=>{rt.value=!0,s("mouseenter",m)},_e=m=>{s("keydown",m)},Os=()=>{var m;(m=ht.value)==null||m.select()},Ae=()=>{s(Nt,""),s("change",""),s("clear"),s("input","")};return q(()=>e.modelValue,()=>{var m;k(()=>Et()),e.validateEvent&&((m=h==null?void 0:h.validate)==null||m.call(h,"change").catch(C=>oe()))}),q(G,()=>Lt()),q(()=>e.type,async()=>{await k(),Lt(),Et()}),Mt(()=>{!e.formatter&&e.parser,Lt(),k(Et)}),t({input:v,textarea:w,ref:ht,textareaStyle:St,autosize:js(e,"autosize"),focus:Jt,blur:Gs,select:Os,clear:Ae,resizeTextarea:Et}),(m,C)=>xe((b(),T("div",de(u(r),{class:u(n),style:u(Ct),role:m.containerRole,onMouseenter:Zs,onMouseleave:Js}),[A(" input "),m.type!=="textarea"?(b(),T(jt,{key:0},[A(" prepend slot "),m.$slots.prepend?(b(),T("div",{key:0,class:P(u(x).be("group","prepend"))},[At(m.$slots,"prepend")],2)):A("v-if",!0),F("div",{class:P(u(l))},[A(" prefix slot "),m.$slots.prefix||m.prefixIcon?(b(),T("span",{key:0,class:P(u(x).e("prefix"))},[F("span",{class:P(u(x).e("prefix-inner")),onClick:Jt},[At(m.$slots,"prefix"),m.prefixIcon?(b(),K(u(ct),{key:0,class:P(u(x).e("icon"))},{default:L(()=>[(b(),K(Ot(m.prefixIcon)))]),_:1},8,["class"])):A("v-if",!0)],2)],2)):A("v-if",!0),F("input",de({id:u(y),ref_key:"input",ref:v,class:u(x).e("inner")},u(d),{type:m.showPassword?xt.value?"text":"password":m.type,disabled:u(f),formatter:m.formatter,parser:m.parser,readonly:m.readonly,autocomplete:m.autocomplete,tabindex:m.tabindex,"aria-label":m.label,placeholder:m.placeholder,style:m.inputStyle,form:e.form,onCompositionstart:Ce,onCompositionupdate:Se,onCompositionend:Re,onInput:he,onFocus:Ee,onBlur:Le,onChange:Te,onKeydown:_e}),null,16,ra),A(" suffix slot "),u(Yt)?(b(),T("span",{key:1,class:P(u(x).e("suffix"))},[F("span",{class:P(u(x).e("suffix-inner")),onClick:Jt},[!u(mt)||!u(Rt)||!u(N)?(b(),T(jt,{key:0},[At(m.$slots,"suffix"),m.suffixIcon?(b(),K(u(ct),{key:0,class:P(u(x).e("icon"))},{default:L(()=>[(b(),K(Ot(m.suffixIcon)))]),_:1},8,["class"])):A("v-if",!0)],64)):A("v-if",!0),u(mt)?(b(),K(u(ct),{key:1,class:P([u(x).e("icon"),u(x).e("clear")]),onMousedown:Is(u(tr),["prevent"]),onClick:Ae},{default:L(()=>[S(u(Tr))]),_:1},8,["class","onMousedown"])):A("v-if",!0),u(Rt)?(b(),K(u(ct),{key:2,class:P([u(x).e("icon"),u(x).e("password")]),onClick:Ys},{default:L(()=>[(b(),K(Ot(u(Xt))))]),_:1},8,["class"])):A("v-if",!0),u(N)?(b(),T("span",{key:3,class:P(u(x).e("count"))},[F("span",{class:P(u(x).e("count-inner"))},vt(u(V))+" / "+vt(u(d).maxlength),3)],2)):A("v-if",!0),u(O)&&u(qt)&&u(Tt)?(b(),K(u(ct),{key:4,class:P([u(x).e("icon"),u(x).e("validateIcon"),u(x).is("loading",u(O)==="validating")])},{default:L(()=>[(b(),K(Ot(u(qt))))]),_:1},8,["class"])):A("v-if",!0)],2)],2)):A("v-if",!0)],2),A(" append slot "),m.$slots.append?(b(),T("div",{key:1,class:P(u(x).be("group","append"))},[At(m.$slots,"append")],2)):A("v-if",!0)],64)):(b(),T(jt,{key:1},[A(" textarea "),F("textarea",de({id:u(y),ref_key:"textarea",ref:w,class:u(g).e("inner")},u(d),{tabindex:m.tabindex,disabled:u(f),readonly:m.readonly,autocomplete:m.autocomplete,style:u(St),"aria-label":m.label,placeholder:m.placeholder,form:e.form,onCompositionstart:Ce,onCompositionupdate:Se,onCompositionend:Re,onInput:he,onFocus:Ee,onBlur:Le,onChange:Te,onKeydown:_e}),null,16,oa),u(N)?(b(),T("span",{key:0,style:st(Ut.value),class:P(u(x).e("count"))},vt(u(V))+" / "+vt(u(d).maxlength),7)):A("v-if",!0)],64))],16,sa)),[[ys,m.type!=="hidden"]])}});var na=gt(aa,[["__file","/home/runner/work/element-plus/element-plus/packages/components/input/src/input.vue"]]);const la=Be(na),ha=ne({color:{type:bt(Object),required:!0},vertical:{type:Boolean,default:!1}});let ye=!1;function Vt(a,t){if(!Cs)return;const s=function(o){var r;(r=t.drag)==null||r.call(t,o)},e=function(o){var r;document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",e),document.removeEventListener("touchmove",s),document.removeEventListener("touchend",e),document.onselectstart=null,document.ondragstart=null,ye=!1,(r=t.end)==null||r.call(t,o)},i=function(o){var r;ye||(o.preventDefault(),document.onselectstart=()=>!1,document.ondragstart=()=>!1,document.addEventListener("mousemove",s),document.addEventListener("mouseup",e),document.addEventListener("touchmove",s),document.addEventListener("touchend",e),ye=!0,(r=t.start)==null||r.call(t,o))};a.addEventListener("mousedown",i),a.addEventListener("touchstart",i)}const da=a=>{const t=Wt(),s=Dt(),e=Dt();function i(r){r.target!==s.value&&o(r)}function o(r){if(!e.value||!s.value)return;const l=t.vnode.el.getBoundingClientRect(),{clientX:d,clientY:c}=Pe(r);if(a.vertical){let h=c-l.top;h=Math.max(s.value.offsetHeight/2,h),h=Math.min(h,l.height-s.value.offsetHeight/2),a.color.set("alpha",Math.round((h-s.value.offsetHeight/2)/(l.height-s.value.offsetHeight)*100))}else{let h=d-l.left;h=Math.max(s.value.offsetWidth/2,h),h=Math.min(h,l.width-s.value.offsetWidth/2),a.color.set("alpha",Math.round((h-s.value.offsetWidth/2)/(l.width-s.value.offsetWidth)*100))}}return{thumb:s,bar:e,handleDrag:o,handleClick:i}},ca=(a,{bar:t,thumb:s,handleDrag:e})=>{const i=Wt(),o=lt("color-alpha-slider"),r=_(0),n=_(0),l=_();function d(){if(!s.value||a.vertical)return 0;const w=i.vnode.el,B=a.color.get("alpha");return w?Math.round(B*(w.offsetWidth-s.value.offsetWidth/2)/100):0}function c(){if(!s.value)return 0;const w=i.vnode.el;if(!a.vertical)return 0;const B=a.color.get("alpha");return w?Math.round(B*(w.offsetHeight-s.value.offsetHeight/2)/100):0}function h(){if(a.color&&a.color.value){const{r:w,g:B,b:rt}=a.color.toRgb();return`linear-gradient(to right, rgba(${w}, ${B}, ${rt}, 0) 0%, rgba(${w}, ${B}, ${rt}, 1) 100%)`}return""}function y(){r.value=d(),n.value=c(),l.value=h()}Mt(()=>{if(!t.value||!s.value)return;const w={drag:B=>{e(B)},end:B=>{e(B)}};Vt(t.value,w),Vt(s.value,w),y()}),q(()=>a.color.get("alpha"),()=>y()),q(()=>a.color.value,()=>y());const p=M(()=>[o.b(),o.is("vertical",a.vertical)]),f=M(()=>o.e("bar")),x=M(()=>o.e("thumb")),g=M(()=>({background:l.value})),v=M(()=>({left:qe(r.value),top:qe(n.value)}));return{rootKls:p,barKls:f,barStyle:g,thumbKls:x,thumbStyle:v,update:y}},ua="ElColorAlphaSlider",ya=Y({name:ua}),ga=Y({...ya,props:ha,setup(a,{expose:t}){const s=a,{bar:e,thumb:i,handleDrag:o,handleClick:r}=da(s),{rootKls:n,barKls:l,barStyle:d,thumbKls:c,thumbStyle:h,update:y}=ca(s,{bar:e,thumb:i,handleDrag:o});return t({update:y,bar:e,thumb:i}),(p,f)=>(b(),T("div",{class:P(u(n))},[F("div",{ref_key:"bar",ref:e,class:P(u(l)),style:st(u(d)),onClick:f[0]||(f[0]=(...x)=>u(r)&&u(r)(...x))},null,6),F("div",{ref_key:"thumb",ref:i,class:P(u(c)),style:st(u(h))},null,6)],2))}});var pa=gt(ga,[["__file","/home/runner/work/element-plus/element-plus/packages/components/color-picker/src/components/alpha-slider.vue"]]);const xa=Y({name:"ElColorHueSlider",props:{color:{type:Object,required:!0},vertical:Boolean},setup(a){const t=lt("color-hue-slider"),s=Wt(),e=_(),i=_(),o=_(0),r=_(0),n=M(()=>a.color.get("hue"));q(()=>n.value,()=>{y()});function l(p){p.target!==e.value&&d(p)}function d(p){if(!i.value||!e.value)return;const x=s.vnode.el.getBoundingClientRect(),{clientX:g,clientY:v}=Pe(p);let w;if(a.vertical){let B=v-x.top;B=Math.min(B,x.height-e.value.offsetHeight/2),B=Math.max(e.value.offsetHeight/2,B),w=Math.round((B-e.value.offsetHeight/2)/(x.height-e.value.offsetHeight)*360)}else{let B=g-x.left;B=Math.min(B,x.width-e.value.offsetWidth/2),B=Math.max(e.value.offsetWidth/2,B),w=Math.round((B-e.value.offsetWidth/2)/(x.width-e.value.offsetWidth)*360)}a.color.set("hue",w)}function c(){if(!e.value)return 0;const p=s.vnode.el;if(a.vertical)return 0;const f=a.color.get("hue");return p?Math.round(f*(p.offsetWidth-e.value.offsetWidth/2)/360):0}function h(){if(!e.value)return 0;const p=s.vnode.el;if(!a.vertical)return 0;const f=a.color.get("hue");return p?Math.round(f*(p.offsetHeight-e.value.offsetHeight/2)/360):0}function y(){o.value=c(),r.value=h()}return Mt(()=>{if(!i.value||!e.value)return;const p={drag:f=>{d(f)},end:f=>{d(f)}};Vt(i.value,p),Vt(e.value,p),y()}),{bar:i,thumb:e,thumbLeft:o,thumbTop:r,hueValue:n,handleClick:l,update:y,ns:t}}});function fa(a,t,s,e,i,o){return b(),T("div",{class:P([a.ns.b(),a.ns.is("vertical",a.vertical)])},[F("div",{ref:"bar",class:P(a.ns.e("bar")),onClick:t[0]||(t[0]=(...r)=>a.handleClick&&a.handleClick(...r))},null,2),F("div",{ref:"thumb",class:P(a.ns.e("thumb")),style:st({left:a.thumbLeft+"px",top:a.thumbTop+"px"})},null,6)],2)}var ma=gt(xa,[["render",fa],["__file","/home/runner/work/element-plus/element-plus/packages/components/color-picker/src/components/hue-slider.vue"]]);const va=ne({modelValue:String,id:String,showAlpha:Boolean,colorFormat:String,disabled:Boolean,size:Ps,popperClass:{type:String,default:""},label:{type:String,default:void 0},tabindex:{type:[String,Number],default:0},predefine:{type:bt(Array)},validateEvent:{type:Boolean,default:!0}}),wa={[Nt]:a=>wt(a)||It(a),[Sr]:a=>wt(a)||It(a),activeChange:a=>wt(a)||It(a)},zs=Symbol("colorPickerContextKey"),rs=function(a,t,s){return[a,t*s/((a=(2-t)*s)<1?a:2-a)||0,a/2]},ba=function(a){return typeof a=="string"&&a.includes(".")&&Number.parseFloat(a)===1},Ba=function(a){return typeof a=="string"&&a.includes("%")},Pt=function(a,t){ba(a)&&(a="100%");const s=Ba(a);return a=Math.min(t,Math.max(0,Number.parseFloat(`${a}`))),s&&(a=Number.parseInt(`${a*t}`,10)/100),Math.abs(a-t)<1e-6?1:a%t/Number.parseFloat(t)},os={10:"A",11:"B",12:"C",13:"D",14:"E",15:"F"},ee=a=>{a=Math.min(Math.round(a),255);const t=Math.floor(a/16),s=a%16;return`${os[t]||t}${os[s]||s}`},is=function({r:a,g:t,b:s}){return Number.isNaN(+a)||Number.isNaN(+t)||Number.isNaN(+s)?"":`#${ee(a)}${ee(t)}${ee(s)}`},ge={A:10,B:11,C:12,D:13,E:14,F:15},dt=function(a){return a.length===2?(ge[a[0].toUpperCase()]||+a[0])*16+(ge[a[1].toUpperCase()]||+a[1]):ge[a[1].toUpperCase()]||+a[1]},Pa=function(a,t,s){t=t/100,s=s/100;let e=t;const i=Math.max(s,.01);s*=2,t*=s<=1?s:2-s,e*=i<=1?i:2-i;const o=(s+t)/2,r=s===0?2*e/(i+e):2*t/(s+t);return{h:a,s:r*100,v:o*100}},as=(a,t,s)=>{a=Pt(a,255),t=Pt(t,255),s=Pt(s,255);const e=Math.max(a,t,s),i=Math.min(a,t,s);let o;const r=e,n=e-i,l=e===0?0:n/e;if(e===i)o=0;else{switch(e){case a:{o=(t-s)/n+(t<s?6:0);break}case t:{o=(s-a)/n+2;break}case s:{o=(a-t)/n+4;break}}o/=6}return{h:o*360,s:l*100,v:r*100}},_t=function(a,t,s){a=Pt(a,360)*6,t=Pt(t,100),s=Pt(s,100);const e=Math.floor(a),i=a-e,o=s*(1-t),r=s*(1-i*t),n=s*(1-(1-i)*t),l=e%6,d=[s,r,o,o,n,s][l],c=[n,s,s,r,o,o][l],h=[o,o,n,s,s,r][l];return{r:Math.round(d*255),g:Math.round(c*255),b:Math.round(h*255)}};class zt{constructor(t={}){this._hue=0,this._saturation=100,this._value=100,this._alpha=100,this.enableAlpha=!1,this.format="hex",this.value="";for(const s in t)ze(t,s)&&(this[s]=t[s]);t.value?this.fromString(t.value):this.doOnChange()}set(t,s){if(arguments.length===1&&typeof t=="object"){for(const e in t)ze(t,e)&&this.set(e,t[e]);return}this[`_${t}`]=s,this.doOnChange()}get(t){return t==="alpha"?Math.floor(this[`_${t}`]):this[`_${t}`]}toRgb(){return _t(this._hue,this._saturation,this._value)}fromString(t){if(!t){this._hue=0,this._saturation=100,this._value=100,this.doOnChange();return}const s=(e,i,o)=>{this._hue=Math.max(0,Math.min(360,e)),this._saturation=Math.max(0,Math.min(100,i)),this._value=Math.max(0,Math.min(100,o)),this.doOnChange()};if(t.includes("hsl")){const e=t.replace(/hsla|hsl|\(|\)/gm,"").split(/\s|,/g).filter(i=>i!=="").map((i,o)=>o>2?Number.parseFloat(i):Number.parseInt(i,10));if(e.length===4?this._alpha=Number.parseFloat(e[3])*100:e.length===3&&(this._alpha=100),e.length>=3){const{h:i,s:o,v:r}=Pa(e[0],e[1],e[2]);s(i,o,r)}}else if(t.includes("hsv")){const e=t.replace(/hsva|hsv|\(|\)/gm,"").split(/\s|,/g).filter(i=>i!=="").map((i,o)=>o>2?Number.parseFloat(i):Number.parseInt(i,10));e.length===4?this._alpha=Number.parseFloat(e[3])*100:e.length===3&&(this._alpha=100),e.length>=3&&s(e[0],e[1],e[2])}else if(t.includes("rgb")){const e=t.replace(/rgba|rgb|\(|\)/gm,"").split(/\s|,/g).filter(i=>i!=="").map((i,o)=>o>2?Number.parseFloat(i):Number.parseInt(i,10));if(e.length===4?this._alpha=Number.parseFloat(e[3])*100:e.length===3&&(this._alpha=100),e.length>=3){const{h:i,s:o,v:r}=as(e[0],e[1],e[2]);s(i,o,r)}}else if(t.includes("#")){const e=t.replace("#","").trim();if(!/^[0-9a-fA-F]{3}$|^[0-9a-fA-F]{6}$|^[0-9a-fA-F]{8}$/.test(e))return;let i,o,r;e.length===3?(i=dt(e[0]+e[0]),o=dt(e[1]+e[1]),r=dt(e[2]+e[2])):(e.length===6||e.length===8)&&(i=dt(e.slice(0,2)),o=dt(e.slice(2,4)),r=dt(e.slice(4,6))),e.length===8?this._alpha=dt(e.slice(6))/255*100:(e.length===3||e.length===6)&&(this._alpha=100);const{h:n,s:l,v:d}=as(i,o,r);s(n,l,d)}}compare(t){return Math.abs(t._hue-this._hue)<2&&Math.abs(t._saturation-this._saturation)<1&&Math.abs(t._value-this._value)<1&&Math.abs(t._alpha-this._alpha)<1}doOnChange(){const{_hue:t,_saturation:s,_value:e,_alpha:i,format:o}=this;if(this.enableAlpha)switch(o){case"hsl":{const r=rs(t,s/100,e/100);this.value=`hsla(${t}, ${Math.round(r[1]*100)}%, ${Math.round(r[2]*100)}%, ${this.get("alpha")/100})`;break}case"hsv":{this.value=`hsva(${t}, ${Math.round(s)}%, ${Math.round(e)}%, ${this.get("alpha")/100})`;break}case"hex":{this.value=`${is(_t(t,s,e))}${ee(i*255/100)}`;break}default:{const{r,g:n,b:l}=_t(t,s,e);this.value=`rgba(${r}, ${n}, ${l}, ${this.get("alpha")/100})`}}else switch(o){case"hsl":{const r=rs(t,s/100,e/100);this.value=`hsl(${t}, ${Math.round(r[1]*100)}%, ${Math.round(r[2]*100)}%)`;break}case"hsv":{this.value=`hsv(${t}, ${Math.round(s)}%, ${Math.round(e)}%)`;break}case"rgb":{const{r,g:n,b:l}=_t(t,s,e);this.value=`rgb(${r}, ${n}, ${l})`;break}default:this.value=is(_t(t,s,e))}}}const Fa=Y({props:{colors:{type:Array,required:!0},color:{type:Object,required:!0}},setup(a){const t=lt("color-predefine"),{currentColor:s}=er(zs),e=_(o(a.colors,a.color));q(()=>s.value,r=>{const n=new zt;n.fromString(r),e.value.forEach(l=>{l.selected=n.compare(l)})}),sr(()=>{e.value=o(a.colors,a.color)});function i(r){a.color.fromString(a.colors[r])}function o(r,n){return r.map(l=>{const d=new zt;return d.enableAlpha=!0,d.format="rgba",d.fromString(l),d.selected=d.value===n.value,d})}return{rgbaColors:e,handleSelect:i,ns:t}}}),Na=["onClick"];function Ma(a,t,s,e,i,o){return b(),T("div",{class:P(a.ns.b())},[F("div",{class:P(a.ns.e("colors"))},[(b(!0),T(jt,null,rr(a.rgbaColors,(r,n)=>(b(),T("div",{key:a.colors[n],class:P([a.ns.e("color-selector"),a.ns.is("alpha",r._alpha<100),{selected:r.selected}]),onClick:l=>a.handleSelect(n)},[F("div",{style:st({backgroundColor:r.value})},null,4)],10,Na))),128))],2)],2)}var Ta=gt(Fa,[["render",Ma],["__file","/home/runner/work/element-plus/element-plus/packages/components/color-picker/src/components/predefine.vue"]]);const Ca=Y({name:"ElSlPanel",props:{color:{type:Object,required:!0}},setup(a){const t=lt("color-svpanel"),s=Wt(),e=_(0),i=_(0),o=_("hsl(0, 100%, 50%)"),r=M(()=>{const d=a.color.get("hue"),c=a.color.get("value");return{hue:d,value:c}});function n(){const d=a.color.get("saturation"),c=a.color.get("value"),h=s.vnode.el,{clientWidth:y,clientHeight:p}=h;i.value=d*y/100,e.value=(100-c)*p/100,o.value=`hsl(${a.color.get("hue")}, 100%, 50%)`}function l(d){const h=s.vnode.el.getBoundingClientRect(),{clientX:y,clientY:p}=Pe(d);let f=y-h.left,x=p-h.top;f=Math.max(0,f),f=Math.min(f,h.width),x=Math.max(0,x),x=Math.min(x,h.height),i.value=f,e.value=x,a.color.set({saturation:f/h.width*100,value:100-x/h.height*100})}return q(()=>r.value,()=>{n()}),Mt(()=>{Vt(s.vnode.el,{drag:d=>{l(d)},end:d=>{l(d)}}),n()}),{cursorTop:e,cursorLeft:i,background:o,colorValue:r,handleDrag:l,update:n,ns:t}}}),Sa=F("div",null,null,-1),Ra=[Sa];function Ea(a,t,s,e,i,o){return b(),T("div",{class:P(a.ns.b()),style:st({backgroundColor:a.background})},[F("div",{class:P(a.ns.e("white"))},null,2),F("div",{class:P(a.ns.e("black"))},null,2),F("div",{class:P(a.ns.e("cursor")),style:st({top:a.cursorTop+"px",left:a.cursorLeft+"px"})},Ra,6)],6)}var La=gt(Ca,[["render",Ea],["__file","/home/runner/work/element-plus/element-plus/packages/components/color-picker/src/components/sv-panel.vue"]]);const _a=["id","aria-label","aria-labelledby","aria-description","tabindex","onKeydown"],Aa=Y({name:"ElColorPicker"}),$a=Y({...Aa,props:va,emits:wa,setup(a,{expose:t,emit:s}){const e=a,{t:i}=Rr(),o=lt("color"),{formItem:r}=Fs(),n=Ms(),l=Ts(),{inputId:d,isLabeledByFormItem:c}=Ns(e,{formItemContext:r}),h=_(),y=_(),p=_(),f=_();let x=!0;const g=gs(new zt({enableAlpha:e.showAlpha,format:e.colorFormat||"",value:e.modelValue})),v=_(!1),w=_(!1),B=_(""),rt=M(()=>!e.modelValue&&!w.value?"transparent":ht(g,e.showAlpha)),j=M(()=>!e.modelValue&&!w.value?"":g.value),xt=M(()=>c.value?void 0:e.label||i("el.colorpicker.defaultLabel")),Ut=M(()=>c.value?r==null?void 0:r.labelId:void 0),ft=M(()=>[o.b("picker"),o.is("disabled",l.value),o.bm("picker",n.value)]);function ht(N,V){if(!(N instanceof zt))throw new TypeError("color should be instance of _color Class");const{r:I,g:Yt,b:Gt}=N.toRgb();return V?`rgba(${I}, ${Yt}, ${Gt}, ${N.get("alpha")/100})`:`rgb(${I}, ${Yt}, ${Gt})`}function Tt(N){v.value=N}const O=Er(Tt,100);function qt(){l.value||Tt(!0)}function Xt(){O(!1),Ct()}function Ct(){k(()=>{e.modelValue?g.fromString(e.modelValue):(g.value="",k(()=>{w.value=!1}))})}function St(){l.value||O(!v.value)}function G(){g.fromString(B.value)}function mt(){const N=g.value;s(Nt,N),s("change",N),e.validateEvent&&(r==null||r.validate("change").catch(V=>oe())),O(!1),k(()=>{const V=new zt({enableAlpha:e.showAlpha,format:e.colorFormat||"",value:e.modelValue});g.compare(V)||Ct()})}function Rt(){O(!1),s(Nt,null),s("change",null),e.modelValue!==null&&e.validateEvent&&(r==null||r.validate("change").catch(N=>oe())),Ct()}return Mt(()=>{e.modelValue&&(B.value=j.value)}),q(()=>e.modelValue,N=>{N?N&&N!==g.value&&(x=!1,g.fromString(N)):w.value=!1}),q(()=>j.value,N=>{B.value=N,x&&s("activeChange",N),x=!0}),q(()=>g.value,()=>{!e.modelValue&&!w.value&&(w.value=!0)}),q(()=>v.value,()=>{k(()=>{var N,V,I;(N=h.value)==null||N.update(),(V=y.value)==null||V.update(),(I=p.value)==null||I.update()})}),or(zs,{currentColor:j}),t({color:g,show:qt,hide:Xt}),(N,V)=>(b(),K(u($r),{ref_key:"popper",ref:f,visible:v.value,"show-arrow":!1,"fallback-placements":["bottom","top","right","left"],offset:0,"gpu-acceleration":!1,"popper-class":[u(o).be("picker","panel"),u(o).b("dropdown"),N.popperClass],"stop-popper-mouse-event":!1,effect:"light",trigger:"click",transition:`${u(o).namespace.value}-zoom-in-top`,persistent:""},{content:L(()=>[xe((b(),T("div",null,[F("div",{class:P(u(o).be("dropdown","main-wrapper"))},[S(ma,{ref_key:"hue",ref:h,class:"hue-slider",color:u(g),vertical:""},null,8,["color"]),S(La,{ref:"svPanel",color:u(g)},null,8,["color"])],2),N.showAlpha?(b(),K(pa,{key:0,ref_key:"alpha",ref:p,color:u(g)},null,8,["color"])):A("v-if",!0),N.predefine?(b(),K(Ta,{key:1,ref:"predefine",color:u(g),colors:N.predefine},null,8,["color","colors"])):A("v-if",!0),F("div",{class:P(u(o).be("dropdown","btns"))},[F("span",{class:P(u(o).be("dropdown","value"))},[S(u(la),{modelValue:B.value,"onUpdate:modelValue":V[0]||(V[0]=I=>B.value=I),"validate-event":!1,size:"small",onKeyup:He(G,["enter"]),onBlur:G},null,8,["modelValue","onKeyup"])],2),S(u(H),{class:P(u(o).be("dropdown","link-btn")),text:"",size:"small",onClick:Rt},{default:L(()=>[Ke(vt(u(i)("el.colorpicker.clear")),1)]),_:1},8,["class"]),S(u(H),{plain:"",size:"small",class:P(u(o).be("dropdown","btn")),onClick:mt},{default:L(()=>[Ke(vt(u(i)("el.colorpicker.confirm")),1)]),_:1},8,["class"])],2)])),[[u(Lr),Xt]])]),default:L(()=>[F("div",{id:u(d),class:P(u(ft)),role:"button","aria-label":u(xt),"aria-labelledby":u(Ut),"aria-description":u(i)("el.colorpicker.description",{color:N.modelValue||""}),tabindex:N.tabindex,onKeydown:He(St,["enter"])},[u(l)?(b(),T("div",{key:0,class:P(u(o).be("picker","mask"))},null,2)):A("v-if",!0),F("div",{class:P(u(o).be("picker","trigger")),onClick:St},[F("span",{class:P([u(o).be("picker","color"),u(o).is("alpha",N.showAlpha)])},[F("span",{class:P(u(o).be("picker","color-inner")),style:st({backgroundColor:u(rt)})},[xe(S(u(ct),{class:P([u(o).be("picker","icon"),u(o).is("icon-arrow-down")])},{default:L(()=>[S(u(_r))]),_:1},8,["class"]),[[ys,N.modelValue||w.value]]),!N.modelValue&&!w.value?(b(),K(u(ct),{key:0,class:P([u(o).be("picker","empty"),u(o).is("icon-close")])},{default:L(()=>[S(u(Ar))]),_:1},8,["class"])):A("v-if",!0)],6)],2)],2)],42,_a)]),_:1},8,["visible","popper-class","transition"]))}});var Da=gt($a,[["__file","/home/runner/work/element-plus/element-plus/packages/components/color-picker/src/color-picker.vue"]]);const pe=Be(Da),za=ne({direction:{type:String,values:["horizontal","vertical"],default:"horizontal"},contentPosition:{type:String,values:["left","center","right"],default:"center"},borderStyle:{type:bt(String),default:"solid"}}),Ha=Y({name:"ElDivider"}),Ka=Y({...Ha,props:za,setup(a){const t=a,s=lt("divider"),e=M(()=>s.cssVar({"border-style":t.borderStyle}));return(i,o)=>(b(),T("div",{class:P([u(s).b(),u(s).m(i.direction)]),style:st(u(e)),role:"separator"},[i.$slots.default&&i.direction!=="vertical"?(b(),T("div",{key:0,class:P([u(s).e("text"),u(s).is(i.contentPosition)])},[At(i.$slots,"default")],2)):A("v-if",!0)],6))}});var Va=gt(Ka,[["__file","/home/runner/work/element-plus/element-plus/packages/components/divider/src/divider.vue"]]);const Qt=Be(Va);class Wa extends pt{constructor(t,s){super(),this.x=0,this.y=0,this.w=20,this.h=14,this.fillStyle="#eeb174",this.strokeStyle="#333",this.ctx=t,this.analysisOptions(s)}analysisOptions(t){t.x&&(this.x=t.x),t.y&&(this.y=t.y),t.w&&(this.w=t.w),t.h&&(this.h=t.h),t.fillStyle&&(this.fillStyle=t.fillStyle),t.strokeStyle&&(this.strokeStyle=t.strokeStyle),t.tiggerFunc&&(this.tiggerFunc=t.tiggerFunc)}draw(){const{ctx:t,x:s,y:e,w:i,h:o,fillStyle:r,strokeStyle:n}=this;t.save(),t.fillStyle=r,t.strokeStyle=n,t.lineWidth=3,t.beginPath(),t.arc(s+i/2,e-3,i/3,0,Math.PI,!0),t.stroke(),t.drawRoundedRect(s,e,i,o,2,2,2,2,!0,!0,!1,!1),t.restore()}containsPoint(t,s=!1){var y;const{x:e,y:i,w:o,h:r}=this,{x:n,y:l}=t,d=this.getImageLines({tl:{x:e,y:i},tr:{x:e+o,y:i},bl:{x:e,y:i+r},br:{x:e+o,y:i+r}}),h=!!(this.findCrossPoints(n,l,d)%2);return h&&s&&((y=this.tiggerFunc)==null||y.call(this)),h}}const Ua=function(a){return a.length===4&&(a=a.slice(0,2)+a.slice(1,2)+a.slice(2,3)+a.slice(2,3)+a.slice(3,4)+a.slice(3,4)),"rgb("+parseInt("0x"+a.slice(1,3))+","+parseInt("0x"+a.slice(3,5))+","+parseInt("0x"+a.slice(5,7))+")"},qa=function(a){const s=(a.includes("rgb")?a:Ua(a)).replace(/rgb\(|rgba\(|\)/g,"").split(",");return .213*s[0]+.715*s[1]+.072*s[2]>255/2},Xa="L";function it(){return((1+Math.random())*65536|0).toString(16).substring(1)}function Ya(){return`${Xa}${it()}${it()}-${it()}-${it()}-${it()}-${it()}${it()}${it()}`}class z extends pt{constructor(t,s){super(),this.width=100,this.height=50,this.titleHeight=24,this.fontSize=12,this.padding=10,this.attrHeight=14,this.borderWidth=1,this.datatypeIconWidth=14,this.x=0,this.y=0,this.attributes=[],this.attributesPrimary=[],this.attributesPrimaryNon=[],this.expandAttrs=[],this.borderColor="#000000",this.textColor="#000000",this.bgColor="#FFFFFF",this.hoverColor="#477DE9",this.attrFocusStyle={color:"#fff",backgroundColor:"#0000ff"},this.quotePrimaryKey=!1,this.physicalTables=!1,this.manualChange=!1,this.ctx=t,this.updateOptions(s)}analysisOptions(t){if(!t)return;const{x:s,y:e,width:i,height:o,id:r,enName:n,cnName:l,type:d,attributes:c,bgC:h,bdC:y,quotePrimaryKey:p,physicalTables:f,manualChange:x,activeAttributeId:g}=t;X(s)&&(this.x=s),X(e)&&(this.y=e),r&&(this.id=r),n&&(this.enName=n),l&&(this.cnName=l),X(i)&&(this.width=i),X(o)&&(this.height=o),d&&(this.type=d),g&&(this.activeAttributeId=g),c&&(this.attributes=c,this.attributesPartition()),h&&(this.bgColor=h),y&&(this.borderColor=y),Bt(p)&&(this.quotePrimaryKey=p),Bt(f)&&(this.physicalTables=f),Bt(x)&&(this.manualChange=x)}updateOptions(t){this.analysisOptions(t),this.calcBoundingBox()}containsPoint(t){var x;const{x:s,y:e}=t,{x:i,y:o,width:r,height:n,attrHeight:l}=this,d=this.getImageLines({tl:{x:i,y:o},tr:{x:i+r,y:o},bl:{x:i,y:o+n},br:{x:i+r,y:o+n}});if(!!!(this.findCrossPoints(s,e,d)%2))return!1;const y=e-o-this.padding-(this.attributesPrimary.length?0:l),p=Math.floor(y/l);return((x=[...this.attributesPrimary,{},...this.attributesPrimaryNon][p])==null?void 0:x.id)??!0}draw(t){this.updateOptions(t),this.drawContainer(),this.drawTitle(),this.drawbody()}drawContainer(){const{ctx:t,x:s,y:e,width:i,height:o,type:r,bgColor:n,borderColor:l,quotePrimaryKey:d,physicalTables:c}=this;if(t.save(),t.strokeStyle=l,t.fillStyle=n,["exclusive","inclusive"].includes(r))t.beginPath(),t.arc(s+i/2,e+i/2,i/2,0,Math.PI,!0),t.closePath(),t.fill(),t.stroke(),r==="exclusive"&&(t.moveTo(s+12,e+6),t.lineTo(s+i-12,e+o-3),t.moveTo(s+i-12,e+6),t.lineTo(s+12,e+o-3),t.stroke());else{const h=d?4:0;t.drawRoundedRect(s,e,i,o,h,h,h,h,!0,!0,c,!0)}t.restore()}drawDataType(t,s,e){const i=t==null?void 0:t.toLocaleUpperCase();let o;i in Dr?o=ce.get("date"):i in zr?o=ce.get("number"):i in Hr&&(o=ce.get("string"));const{ctx:r}=this;if(!o)return r.save(),r.fillStyle="#808080",r.fillText("?",s,e,this.fontSize),r.restore(),!1;r.drawImage(o,s,e,this.fontSize,this.fontSize)}drawTitle(){const{ctx:t,textColor:s,enName:e,width:i,x:o,y:r,titleHeight:n,fontSize:l}=this;t.save(),t.font=`${l}px`,t.fillStyle=s,t.textAlign="left",t.textBaseline="top",t.fillText(t.fittingString(e,i-14),o,r-n),t.restore()}drawbody(){const{ctx:t,x:s,y:e,bgColor:i,fontSize:o,padding:r,attrHeight:n,attributesPrimary:l,attributesPrimaryNon:d}=this;t.save(),t.font=`${o}px Arial`,t.fillStyle=qa(i)?"#000":"#fff",t.textAlign="left",t.textBaseline="top";const c=r+s;let h=e+r-n;for(let y=0;y<l.length;y++){const p=l[y];h=this.drawAttrRow(p,c,h)}h=this.drawSplitLine(h);for(let y=0;y<d.length;y++){const p=d[y];h=this.drawAttrRow(p,c,h)}t.restore()}drawAttrRow(t,s,e){var g;const{ctx:i,attrHeight:o,padding:r,fontSize:n,x:l,y:d,width:c,height:h,attrFocusStyle:y}=this;if(e+=o,e+16>h+d)return;this.activeAttributeId===t.id&&(i.save(),i.fillStyle=y.backgroundColor,i.fillRect(s+n,e-1,c-(s-l)-r-n,o),i.restore()),this.drawDataType(t.type,s,e);const p=t.foreignKey?"(FK)":"",f=i.fittingString(t.name+p,c-(s-l)-r-n);i.fillText(f,s+n,e);const x=s+i.measureText(f).width+n;if(this.drawIcons(t.icons,x,e),(g=t.children)!=null&&g.length){const v=this.expandAttrs.includes(t);this.drawTreeExpandArrow.call(this,{x:s,y:e,size:n,expand:v}),v&&t.children.forEach(w=>{e=this.drawAttrRow(w,s+10,e)})}return e}drawIcons(t=[],s,e){const{fontSize:i,x:o,width:r,padding:n}=this;for(let l=0;l<t.length;l++){const d=t[l],c=s+i*.7+l*(i*1.2);if(c+i/2*3>o+r+n)return;this.drawIcon(d,c,e)}}drawIcon(t,s,e){const{ctx:i,attrHeight:o,fontSize:r}=this;i.save(),i.beginPath(),i.strokeStyle=t.bdC||"#0C64EB",i.fillStyle=t.bgC||"#ECF5FF",i.arc(s,e+Math.floor(o/2)-1,r/2,0,2*Math.PI),i.fill(),i.stroke(),i.fillStyle=t.color||"#0C64EB",i.font=`${Math.ceil(r/1.2)}px Arial`,i.textAlign="center",i.fillText(t.text,s,e+(o-r)/2+1),i.restore()}drawSplitLine(t){const{ctx:s,attributesPrimary:e,attrHeight:i,x:o,y:r,width:n,height:l}=this;return t+=(e.length?1:2)*i,s.save(),t<l+r&&(s.beginPath(),s.strokeStyle="#000",s.moveTo(o+.5,t+i/3+.5),s.lineTo(o+n+.5,t+i/3+.5),s.stroke()),s.restore(),t}drawTreeExpandArrow({x:t,y:s,size:e,expand:i}){const{ctx:o}=this;o.save(),o.beginPath(),o.translate(t-4,s+e/2),i&&o.rotate(90*Math.PI/180),o.moveTo(-2,-4),o.lineTo(-2,4),o.lineTo(2,0),o.fill(),o.restore()}drawFocusAttr({attrItem:t,finalText:s,curX:e,curY:i,fullWidth:o,nodePadding:r}){var h,y;const{ctx:n,attrFocusStyle:l}=this,d=(h=t==null?void 0:t.children)!=null&&h.length?e:e-r/2,c=(y=t==null?void 0:t.children)!=null&&y.length?o-r/2:o;n.save(),n.fillStyle=l.backgroundColor,n.fillRect(d,i-1,c,16),n.fillStyle=l.color,n.fillText(s,e,i),n.restore()}attributesPartition(){this.attributesPrimary=[],this.attributesPrimaryNon=[];const{attributes:t,attributesPrimary:s,attributesPrimaryNon:e}=this;for(let i=0;i<t.length;i++){const o=t[i];o.primaryKey?s.push(o):e.push(o),o.id||(o.id=Ya())}}getAttributeInfo(t){const{attributesPrimary:s,attributesPrimaryNon:e,x:i,y:o,width:r,height:n,padding:l,attrHeight:d}=this,c=[...s,{},...e],h=c.findIndex(p=>p.id===t);return{x:i+l,y:o+l+(s.length?h:h+1)*d,width:r-2*l,height:d,info:c[h]}}calcBoundingBox(){const{x:t,y:s,width:e,height:i}=this;this.boundingBox=[[t,s],[t+e,s],[t,s+i],[t+e,s+i]]}}class Z extends pt{constructor(t,s){super(),this.width=100,this.height=50,this.titleHeight=24,this.fontSize=16,this.padding=10,this.attrHeight=16,this.borderWidth=1,this.datatypeIconWidth=14,this.x=0,this.y=0,this.attributes=[],this.attributesPrimary=[],this.attributesPrimaryNon=[],this.expandAttrs=[],this.borderColor="#000000",this.textColor="#000000",this.hoverColor="#477DE9",this.attrFocusStyle={color:"#fff",backgroundColor:"#0000ff"},this.quotePrimaryKey=!1,this.physicalTables=!1,this.manualChange=!1,this.ctx=t,this.analysisOptions(s),this.calcBoundingBox()}analysisOptions(t){if(!t)return;const{x:s,y:e,width:i,height:o,id:r,enName:n,cnName:l,type:d,bgC:c,bdC:h,quotePrimaryKey:y,physicalTables:p,manualChange:f}=t;X(s)&&(this.x=s),X(e)&&(this.y=e),r&&(this.id=r),n&&(this.enName=n),l&&(this.cnName=l),X(i)&&(this.width=i),X(o)&&(this.height=o),d&&(this.type=d),c&&(this.bgColor=c),h&&(this.borderColor=h),Bt(y)&&(this.quotePrimaryKey=y),Bt(p)&&(this.physicalTables=p),Bt(f)&&(this.manualChange=f)}updateOptions(t){this.analysisOptions(t),this.calcBoundingBox()}containsPoint(t){const{x:s,y:e}=t,{x:i,y:o,width:r,height:n}=this,l=this.getImageLines({tl:{x:i,y:o},tr:{x:i+r,y:o},bl:{x:i,y:o+n},br:{x:i+r,y:o+n}});return!!(this.findCrossPoints(s,e,l)%2)}draw(t){this.analysisOptions(t),this.drawRect()}drawRect(){const{ctx:t,x:s,y:e,width:i,height:o,bgColor:r,borderColor:n}=this;t.save(),t.lineWidth=2.5,t.strokeStyle=n||"#000000",t.fillStyle=r||"#ffffff",t.drawRoundedRect(s,e,i,o,0,0,0,0,!!r,!0,!1,!1),t.restore()}calcBoundingBox(){const{x:t,y:s,width:e,height:i}=this;this.boundingBox=[[t,s],[t+e,s],[t,s+i],[t+e,s+i]]}}const ns=(a,t,s=0)=>{const{x:e,y:i}=a,o=s||0,r=s||0;for(let n=0;n<t.length-1;n++){const l=t[n],d=t[n+1],c=l.y-d.y,h=d.x-l.x,y=l.x*d.y-d.x*l.y;if(Math.abs(c*e+h*i+y)/Math.sqrt(c*c+h*h)<=o&&e>=Math.min(l.x,d.x)-o&&e<=Math.max(l.x,d.x)+o&&i>=Math.min(l.y,d.y)-r&&i<=Math.max(l.y,d.y)+r)return n}return!1};class U extends pt{constructor(t,s){super(),this.pos=[],this.lineWidth=1,this.strokeStyle="#000000",this.ctx=t,this.analysisOptions(s),this.calcBoundingBox()}analysisOptions(t){if(!t)return;const{pos:s,type:e,from:i,to:o,id:r,lineWidth:n,numLineTypes:l,strokeStyle:d}=t;r&&(this.id=r),i&&(this.from=i),o&&(this.to=o),s&&(this.pos=s),e&&(this.type=e),l&&(this.numLineTypes=l),n&&(this.lineWidth=n),d&&(this.strokeStyle=d)}updateOptions(t){this.analysisOptions(t),this.calcBoundingBox()}draw(t){this.analysisOptions(t),this.drawLine(),this.drawEnds(),this.drawNote()}containsPoint(t){const{pos:s}=this;return X(ns(t,s,5))}getIndexInPos(t){return ns(t,this.pos,5)}drawLine(){const{ctx:t,strokeStyle:s,lineWidth:e,type:i,pos:o}=this;t.save(),t.strokeStyle=s,t.lineWidth=e,i==="foreignKey"&&t.setLineDash([8,5]),o.forEach((r,n)=>{n===0?(t.beginPath(),t.moveTo(r.x,r.y)):t.lineTo(r.x,r.y)}),t.stroke(),t.restore()}drawEnds(){const{ctx:t,pos:s,strokeStyle:e,lineWidth:i,numLineTypes:o}=this,r=15,n=s.length||0;if(!(n<2)){if(t.save(),t.beginPath(),t.setLineDash([0,0]),t.strokeStyle=e,t.lineWidth=i,s[0].x===s[1].x){const l=s[1].y-s[0].y,d=Math.abs(l)<10?l<0?s[0].y-1:s[0].y+1:l<0?s[0].y-10:s[0].y+10;t.moveTo(s[0].x-r/2,d),t.lineTo(s[0].x+r/2,d)}else{const l=s[1].x-s[0].x,d=Math.abs(l)<10?l<0?s[0].x-1:s[0].x+1:l<0?s[0].x-10:s[0].x+10;t.moveTo(d,s[0].y-r/2),t.lineTo(d,s[0].y+r/2)}if(s[n-2].x===s[n-1].x){const l=s[n-1].y-s[n-2].y,d=Math.abs(l)<10?l<0?s[n-1].y+1:s[n-1].y-1:l<0?s[n-1].y+10:s[n-1].y-10;if(t.moveTo(s[n-1].x-r/2,d),t.lineTo(s[n-1].x+r/2,d),t.stroke(),[1,2].includes(o)&&(t.moveTo(s[n-1].x-r/2,s[n-1].y),t.lineTo(s[n-1].x,d),t.lineTo(s[n-1].x+r/2,s[n-1].y),t.stroke()),[1,4].includes(o)){t.beginPath();const c=s[n-1].x,h=l<0?d+r/2:d-r/2;t.arc(c,h,(r-2)/2,0,360,!1),t.fillStyle="#fff",t.fill(),t.stroke()}}else{const l=s[n-1].x-s[n-2].x,d=Math.abs(l)<10?l<0?s[n-1].x+1:s[n-1].x-1:l<0?s[n-1].x+10:s[n-1].x-10;if(t.moveTo(d,s[n-1].y-r/2),t.lineTo(d,s[n-1].y+r/2),t.stroke(),[1,2].includes(o)&&(t.moveTo(s[n-1].x,s[n-1].y-r/2),t.lineTo(d,s[n-1].y),t.lineTo(s[n-1].x,s[n-1].y+r/2),t.stroke()),[1,4].includes(o)){t.beginPath();const c=l<0?d+r/2:d-r/2,h=s[n-1].y;t.arc(c,h,(r-2)/2,0,360,!1),t.fillStyle="#fff",t.fill(),t.stroke()}}t.restore()}}drawNote(){const{ctx:t,pos:s,remark:e}=this;if(!e)return;const i=Math.floor(s.length/2)-1;let o,r,n;s[i].y===s[i+1].y?(n=!1,o=Math.abs(s[i+1].x-s[i].x)/2+Math.min(s[i+1].x,s[i].x),r=s[i].y-10):(n=!0,o=s[i].x+10,r=Math.abs(s[i+1].y-s[i].y)/2+Math.min(s[i+1].y,s[i].y)-t.measureText(e).width/2),t.textAlign="center",n?t.fillRowText(e,o,r,16,16):t.fillText(e,o,r)}calcBoundingBox(){const{pos:t}=this,s=[],e=[];for(let i=0;i<t.length;i++){const o=t[i];s.push(o.x),e.push(o.y)}this.boundingBox=[[Math.min(...s),Math.min(...e)],[Math.max(...s),Math.max(...e)]]}}const Ga=(a,t=-1/0,s=1/0)=>Math.max(Math.min(a,s),t);class Ja{constructor(t){this.originData={nodeDataArray:[],linkDataArray:[],markDataArray:[],noteDataArray:[]},this.originDataMap=new Map,this.update(t),this.mountAutoUpdate()}update(t){this.analysisOptions(t)}analysisOptions(t){const{data:s={nodeDataArray:[],linkDataArray:[],markDataArray:[],noteDataArray:[]},context:e}=t;e&&(this.context=e),this.originData=s,this.initMap()}initMap(){const{originData:{nodeDataArray:t=[],linkDataArray:s=[],markDataArray:e=[],noteDataArray:i=[]},originDataMap:o}=this;o.clear();for(let r=0;r<t.length;r++){const n=t[r];o.set(n.id,n)}for(let r=0;r<s.length;r++){const n=s[r];o.set(n.id,n)}for(let r=0;r<e.length;r++){const n=e[r];o.set(n.id,n)}for(let r=0;r<i.length;r++){const n=i[r];o.set(n.id,n)}}mountAutoUpdate(){const{originDataMap:t,context:s}=this;s.on("node:move",e=>{const i=t.get(e.id);i.x=e.x,i.y=e.y,i.width=e.width,i.height=e.height}),s.on("node:resize",e=>{const i=t.get(e.id);i.x=e.x,i.y=e.y,i.width=e.width,i.height=e.height}),s.on("line:move",e=>{const i=t.get(e.id);i.pos=e.pos}),s.on("note:move",e=>{const i=t.get(e.id);i.x=e.x,i.y=e.y}),s.on("mark:move",e=>{const i=t.get(e.id);i.x=e.x,i.y=e.y,i.width=e.width,i.height=e.height}),s.on("mark:resize",e=>{const i=t.get(e.id);i.x=e.x,i.y=e.y,i.width=e.width,i.height=e.height})}unmountAutoUpdate(){const{context:t}=this;t.off()}freeVariable(){this.originData=null,this.originDataMap=null}destroy(){this.unmountAutoUpdate(),this.freeVariable()}}class at extends pt{constructor(t,s){super(),this.x=0,this.y=0,this.width=0,this.height=0,this.borderColor="#0C64EB",this.textColor="#0C64EB",this.bgColor="#D0E2FF",this.borderWidth=1,this.ctx=t,this.updateOptions(s)}analysisOptions(t){if(!t)return;const{x:s=0,y:e=0,id:i,borderColor:o,textColor:r,bgColor:n,borderWidth:l,content:d}=t;X(s)&&(this.x=s),X(e)&&(this.y=e),i&&(this.id=i),o&&(this.borderColor=o),r&&(this.textColor=r),n&&(this.bgColor=n),X(l)&&(this.borderWidth=l),d&&(this.content=d)}updateOptions(t){this.analysisOptions(t),this.calcBoundingBox()}containsPoint(t){const{x:s,y:e}=t,{x:i,y:o,width:r,height:n}=this;return s>=i&&s<=i+r&&e>=o&&e<=o+n}draw(t){this.updateOptions(t);const{ctx:s,content:e,x:i,y:o,textColor:r}=this;s.save(),s.textBaseline="top",s.fillStyle=r,s.fillText(e,i,o),s.restore()}calcBoundingBox(){const{x:t,y:s,ctx:e,content:i}=this,o=e.measureText(i),r=this.width=o.width,n=this.height=o.actualBoundingBoxAscent+o.actualBoundingBoxDescent;this.boundingBox=[[t,s],[t+r,s],[t,s+n],[t+r,s+n]]}}class Za extends pt{constructor(t,s){super(),this.width=100,this.height=50,this.x=0,this.y=0,this.lineWidth=1,this.borderColor="blue",this.targetWidth=6,this.targetBgColor="#FFFFFF",this.targetBdColor="#B4B4B4",this.ctx=t,this.updateOptions(s)}analysisOptions(t){if(!t)return;const{x:s=0,y:e=0,width:i,height:o,targetBgColor:r,targetBdColor:n,bdC:l,lineWidth:d}=t;s&&(this.x=s),e&&(this.y=e),i&&(this.width=i),o&&(this.height=o),r&&(this.targetBgColor=r),n&&(this.targetBdColor=n),l&&(this.borderColor=l),d&&(this.lineWidth=d)}updateOptions(t){this.analysisOptions(t),this.calcBoundingBox()}containsPoint(){return!1}draw(t){this.updateOptions(t),this.drawBorder(),this.drawTargets()}drawBorder(){const{ctx:t,borderColor:s,lineWidth:e,x:i,y:o,width:r,height:n}=this;t.save(),t.lineWidth=e,t.strokeStyle=s,t.strokeRect(i,o,r,n),t.restore()}drawTargets(){const{ctx:t,targetBdColor:s,targetBgColor:e,targetWidth:i,x:o,y:r,width:n,height:l}=this,d=i/2,c=o-d,h=r-d;t.save(),t.strokeStyle=s,t.fillStyle=e,t.fillRect(c,h,i,i),t.fillRect(c,h+l/2,i,i),t.fillRect(c,h+l,i,i),t.fillRect(c+n/2,h,i,i),t.fillRect(c+n/2,h+l,i,i),t.fillRect(c+n,h,i,i),t.fillRect(c+n,h+l/2,i,i),t.fillRect(c+n,h+l,i,i),t.strokeRect(c,h,i,i),t.strokeRect(c,h+l/2,i,i),t.strokeRect(c,h+l,i,i),t.strokeRect(c+n/2,h,i,i),t.strokeRect(c+n/2,h+l,i,i),t.strokeRect(c+n,h,i,i),t.strokeRect(c+n,h+l/2,i,i),t.strokeRect(c+n,h+l,i,i),t.restore()}calcBoundingBox(){const{x:t,y:s,width:e,height:i}=this;this.boundingBox=[[t,s],[t+e,s],[t,s+i],[t+e,s+i]]}}class Oa extends pt{constructor(t,s){super(),this.width=100,this.height=50,this.x=0,this.y=0,this.lineWidth=2,this.borderColor="blue",this.ctx=t,this.updateOptions(s)}analysisOptions(t){if(!t)return;const{x:s=0,y:e=0,width:i,height:o,bdC:r,lineWidth:n}=t;s&&(this.x=s),e&&(this.y=e),i&&(this.width=i),o&&(this.height=o),r&&(this.borderColor=r),r&&(this.lineWidth=n)}updateOptions(t){this.analysisOptions(t),this.calcBoundingBox()}containsPoint(){return!1}draw(t){this.updateOptions(t),this.drawBorder()}drawBorder(){const{ctx:t,borderColor:s,lineWidth:e,x:i,y:o,width:r,height:n}=this;t.save(),t.lineWidth=e,t.strokeStyle=s,t.strokeRect(i,o,r,n),t.restore()}calcBoundingBox(){const{x:t,y:s,width:e,height:i}=this;this.boundingBox=[[t,s],[t+e,s],[t,s+i],[t+e,s+i]]}}var D=(a=>(a.None="",a.addNode="addNode",a.primaryKey="primaryKey",a.foreignKey="foreignKey",a.branchLine="branchLine",a.addMark="addMark",a.addNote="addNote",a.copy="copy",a))(D||{}),$=(a=>(a.NONE="",a.LT="LT",a.TM="TM",a.RT="RT",a.LM="LM",a.RM="RM",a.LB="LB",a.BM="BM",a.RB="RB",a))($||{}),E=(a=>(a.default="default",a.none="none",a.wait="wait",a.progress="progress",a.crosshair="crosshair",a.cell="cell",a.text="text",a.move="move",a.colResize="col-resize",a.rowResize="row-resize",a.ewResize="ew-resize",a.nsResize="ns-resize",a.neswResize="nesw-resize",a.nwseResize="nwse-resize",a.copy="copy",a.help="help",a.grab="grab",a.grabbing="grabbing",a.pointer="pointer",a.notAllowed="not-allowed",a.zoomIn="zoom-in",a.zoomOut="zoom-out",a.contextMenu="context-menu",a))(E||{}),Ht=(a=>(a.Zoom="graph:zoom",a.Move="graph:move",a.BeforeUpdate="graph:beforeUpdate",a.AfterUpdate="graph:afterUpdate",a.MouseDown="graph:mousedown",a.MouseUp="graph:mouseup",a))(Ht||{}),nt=(a=>(a.Move="node:move",a.Resize="node:resize",a.MouseDown="node:mousedown",a.MouseUp="node:mouseup",a.Enter="node:enter",a.Leave="node:leave",a))(nt||{}),et=(a=>(a.Move="line:move",a.MouseDown="line:mousedown",a.MouseUp="line:mouseup",a.Enter="line:enter",a.Leave="line:leave",a))(et||{}),yt=(a=>(a.Move="mark:move",a.Resize="mark:resize",a.MouseDown="mark:mousedown",a.MouseUp="mark:mouseup",a.Enter="mark:enter",a.Leave="mark:leave",a))(yt||{}),Ft=(a=>(a.Move="note:move",a.MouseDown="note:mousedown",a.MouseUp="note:mouseup",a.Enter="note:enter",a.Leave="note:leave",a))(Ft||{}),Hs=(a=>(a.Show="contextmenu:show",a.Click="contextmenu:click",a.Hide="contextmenu:hide",a))(Hs||{});const Ks=(a,t)=>{if(!(a instanceof z||a instanceof Z))return!1;const{x:e,y:i,width:o,height:r}=a,n=e+o/2,l=i+r/2,d=e+o,c=i+r,h=5;let y=$.NONE;return Math.abs(e-t.x)<=h&&Math.abs(i-t.y)<=h?y=$.LT:Math.abs(n-t.x)<=h&&Math.abs(i-t.y)<=h?y=$.TM:Math.abs(d-t.x)<=h&&Math.abs(i-t.y)<=h?y=$.RT:Math.abs(e-t.x)<=h&&Math.abs(l-t.y)<=h?y=$.LM:Math.abs(d-t.x)<=h&&Math.abs(l-t.y)<=h?y=$.RM:Math.abs(e-t.x)<=h&&Math.abs(c-t.y)<=h?y=$.LB:Math.abs(n-t.x)<=h&&Math.abs(c-t.y)<=h?y=$.BM:Math.abs(d-t.x)<=h&&Math.abs(c-t.y)<=h&&(y=$.RB),y},Qa=function(a,t){const s=()=>{const{eventObj:h}=this,y={x:t.x-h.targetOffsetX-h.target.x,y:t.y-h.targetOffsetY-h.target.y},p={x:h.target.x+y.x,y:h.target.y+y.y};this.markMap.get(h.target.id).updateOptions(p),this.emit(yt.Move,this.markMap.get(h.target.id)),this.update()},e=()=>{const{eventObj:h}=this,y={x:t.x-h.targetOffsetX-h.target.x,y:t.y-h.targetOffsetY-h.target.y},p={x:h.target.x+y.x,y:h.target.y+y.y};this.noteMap.get(h.target.id).updateOptions(p),this.emit(Ft.Move,h.target),this.update()},i=()=>{const{eventObj:h}=this,{x:y,y:p}=t;h.target.type==="mark"?this.resizeNode(y,p,h,null):this.resizeNode(y,p,h),this.update()},o=()=>{const{focusTarget:h,eventObj:y,nodeRelatedLineMap:p}=this,f={x:t.x-y.targetOffsetX-y.target.x,y:t.y-y.targetOffsetY-y.target.y};h.forEach(x=>{if(!(x instanceof z))return;const g={x:x.x+f.x,y:x.y+f.y};p.has(x.id)&&[...p.get(x.id).from,...p.get(x.id).to].forEach(w=>{w.from===w.to?this.moveLineForSameNode(w,{target:x}):this.moveLineForNode(w,{target:x},g)}),this.nodeMap.get(x.id).updateOptions(g),this.emit(nt.Move,x)}),this.update()},r=()=>{console.log("attr");const{eventObj:h}=this;h.target,h.targetAttrId,this.updateEventCanvas()},n=()=>{const{eventObj:h}=this,y=h.target.getIndexInPos(h.lastEvLoc);h.targetLineStartPointIdx=y,h.lastEvLoc=t,y!==!1&&(this.moveLineForLine(h,t),this.update())};return{changeMouseCursor:()=>{const{editType:h,renderElements:y}=this,f={[D.addNode]:E.cell,[D.primaryKey]:E.crosshair,[D.foreignKey]:E.crosshair,[D.branchLine]:E.crosshair,[D.addMark]:E.cell,[D.addNote]:E.text,[D.copy]:E.copy}[h];if(f)return this.canvas.eventEl.style.cursor=f||E.default;let x=null,g=E.grab;for(let v=y.length-1;v>=0;v--){const w=y[v],B=w.containsPoint(t)||Ks(w,t);if(B){x=w,g=B===$.LT?E.nwseResize:B===$.TM?E.nsResize:B===$.RT?E.neswResize:B===$.LM||B===$.RM?E.ewResize:B===$.LB?E.neswResize:B===$.BM?E.nsResize:B===$.RB?E.nwseResize:E.move;break}}if(this.hoverTarget!==x){const v=this.hoverTarget instanceof z?nt:this.hoverTarget instanceof U?et:this.hoverTarget instanceof Z?yt:this.hoverTarget instanceof at?Ft:null,w=x instanceof z?nt:x instanceof U?et:x instanceof Z?yt:x instanceof at?Ft:null;v&&this.emit(v.Leave,this.hoverTarget),w&&this.emit(w.Enter,x)}this.hoverTarget=x,this.canvas.eventEl.style.cursor=g,this.updateEventCanvas()},moveCanvas:()=>{this.canvas.setTranslate(a),this.canvas.clearEventCanvas();const h=this.canvas.getTranslate();this.emit(Ht.Move,h),this.update()},moveElement:()=>{const{eventObj:h}=this,y=h.targetAttrId,p=!!h.targetDirection,f=h.target instanceof z,x=h.target instanceof U,g=h.target instanceof Z,v=h.target instanceof at;if(y)return r();if(p)return i();if(f)return o();if(x)return n();if(g)return s();if(v)return e()}}},ka=function(a,t){const{x:s,y:e}=t;return{execTask:()=>{var d,c,h,y,p;const{editType:r,defaultWidth:n,defaultHeight:l}=this;switch(r){case D.copy:{const f={x:s-((c=(d=this.copyTarget)==null?void 0:d[0])==null?void 0:c.x),y:e-((y=(h=this.copyTarget)==null?void 0:h[0])==null?void 0:y.y)},x=this.copyTarget.filter(g=>!!g.attributes).map(g=>(g.x=g.x+f.x,g.y=g.y+f.y,g));(p=this.externalFn)==null||p.handlePaste(x),this.editType=D.None,this.canvas.eventEl.style.cursor=E.default,this.update();break}case D.addNode:{const f={x:s-n/2,y:e-l/2,width:n,height:l};this.externalFn.addNode(f),this.editType=D.None,this.canvas.eventEl.style.cursor=E.default,this.update();break}case D.addMark:{const f={id:this.createKey(),x:s,y:e,width:n,height:l,type:"mark"};this.externalFn.addMark(f),this.editType=D.None,this.canvas.eventEl.style.cursor=E.default,this.update();break}case D.addNote:{const f={id:this.createKey(),x:s,y:e,text:"",type:"note"};this.externalFn.addNote(f),this.editType=D.None,this.canvas.eventEl.style.cursor=E.default;break}}},setEventTarget:r=>{const{metaKey:n,ctrlKey:l}=r,{hoverTarget:d,focusTarget:c,eventObj:h}=this;if(h.target=d,this.canvas.eventEl.style.cursor=E.grabbing,!d){c.clear(),this.updateEventCanvas();return}const y=d instanceof z?nt:d instanceof U?et:d instanceof Z?yt:d instanceof at?Ft:null;this.emit(y.MouseDown,d);const p=Ks(d,t),f=d.containsPoint(t);if(d instanceof z&&c.has(d)&&!p&&!$t(f))return h.targetAttrId=f;!l&&!n&&c.clear(),d instanceof U?(c.clear(),h.lastEvLoc=t):(d instanceof z||d instanceof at||d instanceof Z)&&(h.targetOffsetX=t.x-d.x,h.targetOffsetY=t.y-d.y,h.targetDirection=p||null),c.add(d),this.updateEventCanvas()}}},ja=function(){return{resetMouseState:()=>{const{hoverTarget:t}=this,s=t instanceof z?nt:t instanceof U?et:t instanceof Z?yt:t instanceof at?Ft:null;s&&this.emit(s.MouseUp,t),this.canvas.eventEl.style.cursor=E.default,this.eventObj={target:null,targetAttrId:null,targetDirection:$.NONE,targetOffsetX:0,targetOffsetY:0,targetLineStartPointIdx:0,lastEvLoc:{x:0,y:0}}}}};function Ia(a,t){const s={id:t},e=[s];for(;e.length>0;){const i=e.shift(),o=[];for(const[r,n]of a){const l=a.has(r),d=n.has(i.id);if(l&&d){const c={id:r};o.push(c),e.push(c),a.delete(r)}}i.children=o}return s}const Vs=100,ae=100,ls=12,tn="sans-serif",en=14,hs=10,fe=100,ut=100;function sn(a,t,s="sans-serif"){const i=document.createElement("canvas").getContext("2d");return i.font=`${t}px ${s}`,i.measureText(a).width}const rn=a=>({width:Math.max(Math.floor(Math.max(...(a.attributes||[]).map(t=>sn(t.name,ls,tn)))+hs*2+ls*2),fe),height:Math.floor(Math.max(((a.attributes||[]).length+1)*en+hs*2,ut))});function on(a,t,s,e){const i=an(a,t).sort((n,l)=>l.children.length-n.children.length),o=nn(a,i);let r=-ut;s==null||s.map(n=>{n.x=o,n.y=r+=ae+ut,n.width=fe,n.height=ut}),e==null||e.map(n=>{n.x=o,n.y=r+=ae+ut,n.width=fe,n.height=ut})}const an=(a,t)=>{var o;const s=new Map;for(const r of a)s.set(r.id,new Set);for(const r of t){const n=s.get(r.to),l=!!n;!s.get(r.from)||!l||n.add(r.from)}const e=[];let i=!1;for(;!i;){if(!s.size){i=!1;break}let r=null;for(const[l,d]of s){const c=r===null,h=d.size<((o=s.get(r))==null?void 0:o.size),y=r===0;if((c||h)&&(r=l),y)break}s.delete(r);const n=Ia(s,r);e.push(n)}return e},nn=(a,t)=>{const s=new Map;return a.map(e=>s.set(e.id,e)),ln(a),t.reduce((e,i)=>e=Ws(s,[i],e,ae),Vs)},ln=a=>{a.map(t=>{if(t.type==="inclusive")return;const s=rn(t);t.width=s.width,t.height=s.height})},Ws=(a,t,s,e)=>{var n;const i=Math.max(...t.map(l=>a.get(l.id).height||ut)),o=e+i+ae;let r=s;for(let l=0;l<t.length;l++){const d=a.get(t[l].id);d.x=r,d.y=e,r+=d.width+Vs,(n=t[l].children)!=null&&n.length&&(r=Math.max(Ws(a,t[l].children,d.x,o),r))}return r};class hn extends Kr{constructor(t){super(),this.eventObj={target:null,targetDirection:$.NONE,targetOffsetX:0,targetOffsetY:0,targetAttrId:null,targetLineStartPointIdx:0,lastEvLoc:{x:0,y:0}},this.rightMenuConfig=[],this.chooseTargets=[],this.imgList={},this.editable=ue.Edit,this.defaultWidth=100,this.defaultHeight=50,this.focusTarget=new Set,this.expandAttrs=[],this.updateConfig(t),this.mountDataHandler(t),this.mountCanvas(),this.mountCanvasEvents(),this.mountPlugins(),Vr().then(()=>this.update())}updateConfig(t){const{el:s,externalFn:e,editable:i,fontFamily:o,rightMenu:r,useRightMenu:n=!1,useAttrFocus:l=!1,useThumbnail:d=!1,useHistory:c=!0}=t;s&&(this.el=s),i&&(this.editable=i||ue.Edit),o&&(this.fontFamily=o),r&&(this.rightMenuConfig=r),$t(n)&&(this.useRightMenu=n),$t(l)&&(this.useAttrFocus=l),$t(d)&&(this.useThumbnail=d),$t(c)&&(this.useHistory=c),e&&(this.externalFn=e)}mountDataHandler(t){this.dataHandler=new Ja({context:this,data:t.data})}destroy(){this.unmountPlugins(),this.unmountCanvasEvents(),this.canvas.destroy(),this.dataHandler.destroy()}mountCanvas(){this.canvas=new Wr({mountEl:this.el,backgroundType:Ur.Checker}),this.cacheCtx=this.canvas.cacheCtx}mountPlugins(){this.plugins=new qr,this.useHistory&&this.plugins.use(ot.History),this.useThumbnail&&this.plugins.use(ot.Thumbnail,{mountEl:this.canvas.boxEl,mainCanvas:this.canvas}),this.useRightMenu&&this.plugins.use(ot.RightMenu,this.el,this.rightMenuConfig)}unmountPlugins(){this.plugins.destroy()}mountCanvasEvents(){this._bindEventMousedown=this.onMouseDown.bind(this),this._bindEventMousemove=this.onMouseMove.bind(this),this._bindEventMouseup=this.onMouseUp.bind(this),this._bindEventResize=this.onResize.bind(this),this._bindEventWheel=this.onWheel.bind(this),this._bindEventContextmenu=this.onContextmenu.bind(this),this._bindEventUndo=this.onUndo.bind(this),this._bindEventRedo=this.onRedo.bind(this),this.canvas.on("canvas:resize",this._bindEventResize),this.canvas.on("canvas:wheel",this._bindEventWheel),this.canvas.on("canvas:mouseup",this._bindEventMouseup),this.canvas.on("canvas:mousedown",this._bindEventMousedown),this.canvas.on("canvas:mousemove",this._bindEventMousemove),this.canvas.on("canvas:contextmenu",this._bindEventContextmenu),this.canvas.on("canvas:undo",this._bindEventUndo),this.canvas.on("canvas:redo",this._bindEventRedo)}unmountCanvasEvents(){this.canvas.off("canvas:resize",this._bindEventResize),this.canvas.off("canvas:wheel",this._bindEventWheel),this.canvas.off("canvas:mouseup",this._bindEventMouseup),this.canvas.off("canvas:mousedown",this._bindEventMousedown),this.canvas.off("canvas:mousemove",this._bindEventMousemove),this.canvas.off("canvas:contextmenu",this._bindEventContextmenu),this.canvas.off("canvas:undo",this._bindEventUndo),this.canvas.off("canvas:redo",this._bindEventRedo)}onUndo(){const t=this.plugins.get(ot.History).undo();t==null||t.reverse(),t||console.warn("撤无可撤")}onRedo(){const t=this.plugins.get(ot.History).redo();t==null||t.reverse(),t||console.warn("恢无可恢")}onMouseUp(t,s){const{resetMouseState:e}=ja.call(this,t,s);e()}onMouseDown(t,s){const{editType:e}=this,{execTask:i,setEventTarget:o}=ka.call(this,t,s);if(e)return i();o(t)}onMouseMove(t,s){const{canvas:e,eventObj:i}=this,{changeMouseCursor:o,moveCanvas:r,moveElement:n}=Qa.call(this,t,s),l=!e.isMouseDown,d=e.isMouseDown&&!i.target,c=e.isMouseDown&&i.target;if(l)return o();if(d)return r();if(c){const h=[...this.focusTarget];for(let y=0;y<h.length;y++){const p=h[y],f={target:p,originValue:{}};if(p instanceof z){const x=es(p,"x","y","width","height");f.originValue=ts(x);const g=this.nodeRelatedLineMap.get(p.id);h.push(...g.from,...g.to)}if(p instanceof U){const x=es(p,"pos");f.originValue=ts(x)}h[y]=f}return this.plugins.get(ot.History).push(()=>{for(let y=0;y<h.length;y++){const{target:p,originValue:f}=h[y];p.updateOptions(f),p instanceof z&&this.emit(nt.Resize,p),p instanceof U&&this.emit(et.Move,p)}this.update()}),n()}}onContextmenu(t){if(!this.useRightMenu)return;const{offsetX:s,offsetY:e}=t,{offsetWidth:i,offsetHeight:o}=t.target;this.emit(Hs.Show,{target:this.hoverTarget}),console.log(this.hoverTarget),this.plugins.get(ot.RightMenu).show({top:e,left:s,innerWidth:i,innerHeight:o,menuConfig:this.rightMenuConfig})}onWheel(t){const{deltaY:s,deltaX:e,ctrlKey:i}=t;if(Math.abs(s)>2||Math.abs(e)>2)if(i){const r=this.canvas.zoomRate,n=Math.floor(Ga(r*100+s,10,200));this.zoom(n)}else{const r=this.canvas.getTranslate();this.canvas.setTranslate({x:r.x-e,y:r.y-s}),this.update()}}onResize(){this.update()}initNodes(){const{dataHandler:{originData:{nodeDataArray:t}},nodeRelatedLineMap:s}=this;if(t!=null&&t.length)for(let e=0;e<t.length;e++){const i=t[e];let o=this.nodeMap.get(i.id);o||(o=new z(this.canvas.cacheCtx,{id:i.id,enName:i.name,cnName:i.cnName,type:i.type,x:i.x,y:i.y,width:i.width,height:i.height,attributes:i.attributes,bdC:i.bdC,bgC:i.bgC,quotePrimaryKey:i.quotePrimaryKey,physicalTables:i.physicalTables}),this.nodeMap.set(i.id,o),s.has(i.id)||s.set(i.id,{from:new Set,to:new Set}))}}renderNodes(){const{nodeMap:t,dataHandler:{originData:s},renderElements:e}=this,i=s.nodeDataArray;for(let o=0;o<i.length;o++){const r=i[o],n=t.get(r.id);n.updateOptions(r),this.canvas.isVisible(n.boundingBox)&&(e.push(n),n.draw())}}renderLines(){const{lineMap:t,dataHandler:{originData:s},renderElements:e,nodeRelatedLineMap:i}=this,o=s.linkDataArray;for(let r=0;r<o.length;r++){const n=o[r];let l=t.get(n.id);this._checkLinePos(n),l?l.updateOptions(n):(l=new U(this.canvas.cacheCtx,{pos:n.pos,type:n.type,from:n.from,to:n.to,id:n.id,numLineTypes:n.numLineTypes}),this.lineMap.set(n.id,l)),i.has(l.from)||i.set(l.from,{from:new Set,to:new Set}),i.has(l.to)||i.set(l.to,{from:new Set,to:new Set}),i.get(l.from).from.add(l),i.get(l.to).to.add(l),this.canvas.isVisible(l.boundingBox)&&(e.push(l),l.draw())}}renderNote(){const{dataHandler:{originData:{noteDataArray:t}},noteMap:s,renderElements:e}=this;for(let i=0;i<t.length;i++){const o=t[i];let r=s.get(o.id);r?r.updateOptions(o):(r=new at(this.canvas.cacheCtx,{id:o.id,content:o.text,textColor:o.color,x:o.x,y:o.y}),this.noteMap.set(o.id,r)),this.canvas.isVisible(r.boundingBox)&&(e.push(r),r.draw())}}updateLayout(){const t=this.dataHandler.originData;on(t.nodeDataArray,t.linkDataArray,t.markDataArray,t.noteDataArray),this.update()}update(t){this.renderElements=[],t&&(this.dataHandler.update({data:t}),this.lineMap=new Map,this.markMap=new Map,this.noteMap=new Map,this.nodeMap=new Map,this.nodeRelatedLineMap=new Map,this.focusTarget.clear(),this.initNodes()),this.canvas.clearCacheCanvas();const s=this.cacheCtx;s.font="15px "+this.fontFamily,s.save(),this.renderMarks(),this.renderLines(),this.renderNodes(),this.renderNote(),s.restore(),this.canvas.update(),this.updateEventCanvas(),this.updateThumbnail()}async updateThumbnail(){const{dataHandler:{originData:{nodeDataArray:t}}}=this,s=this.plugins.get(ot.Thumbnail);if(!s)return!1;await Xr();const{width:e,height:i}=this.canvas.getRenderSize();let o=0,r=0,n=e,l=i;for(let d=0;d<t.length;d++){const c=t[d],{x:h,y,width:p,height:f}=c;h<o&&(o=h),y<r&&(r=y),h+p>n&&(n=h+p),y+f>l&&(l=y+f)}s.draw(o,r,n,l,d=>{for(let c=0;c<t.length;c++){const h=t[c],{x:y,y:p,width:f,height:x,bgC:g,bdC:v}=h;d.save(),d.fillStyle=g||"#fff",d.fillRect(y,p,f,x),d.strokeStyle=v||"#000",d.strokeRect(y,p,f,x),d.restore()}})}updateEventCanvas(){this.emit(Ht.BeforeUpdate,this.canvas.eventCtx),this.canvas.clearEventCanvas(),this.drawFocusElement(),this.drawFocusAttribute(),this.drawHoverElement(),this.drawLockIcon(),this.emit(Ht.AfterUpdate,this.canvas.eventCtx)}drawFocusElement(){const{canvas:t,focusTarget:s,eventObj:e}=this;s.forEach(i=>{i instanceof z?new Za(t.eventCtx,{x:i.x,y:i.y,width:i.width,height:i.height}).draw():i instanceof U?new U(t.eventCtx,{...i,lineWidth:3,strokeStyle:"blue"}).draw():i instanceof Z&&new Z(t.eventCtx,{...i}).draw()})}drawFocusAttribute(){const{canvas:t,focusTarget:s,eventObj:{targetAttrId:e,target:i}}=this;if(!e)return;const o=i.getAttributeInfo(e);t.eventCtx.save(),t.eventCtx.fillStyle=i.attrFocusStyle.backgroundColor,t.eventCtx.fillRect(o.x,o.y,o.width,o.height),t.eventCtx.restore()}drawHoverElement(){const{canvas:t,hoverTarget:s,focusTarget:e}=this,i=e.has(s);!s||i||(s instanceof z?new Oa(t.eventCtx,{x:s.x,y:s.y,width:s.width,height:s.height}).draw():s instanceof U&&new U(t.eventCtx,{...s,lineWidth:2,strokeStyle:"blue"}).draw())}copy(){if(!this.focusTarget.size)return;const t=JSON.parse(JSON.stringify([...this.focusTarget])),{handleCopy:s}=this.externalFn;if(!((s==null?void 0:s(t,this.copyTarget))!==!1))return!1;this.copyTarget=t,this.editType=D.copy,this.el.style.cursor=E.copy}setEditable(t){this.editable=t,this.update()}drawLockIcon(){if(this.editable===ue.Edit)return;const t=this.canvas.getTranslate();new Wa(this.canvas.eventCtx,{x:-t.x+this.canvas.width-40,y:-t.y+25}).draw()}_checkLinePos(t){var l,d;const{dataHandler:{originDataMap:s}}=this;if(((l=t.pos)==null?void 0:l.length)<2||((d=t.pos)==null?void 0:d.length)>4)return this.mergeLines([t]);const i=s.get(t.from),o=s.get(t.to),r=this.getPointBelongBord(i,t.pos[0]),n=this.getPointBelongBord(o,t.pos[t.pos.length-1]);if(r&&n)return!0;this.mergeLines([t])}_drawFocus(t,s,e,i){const o=this.cacheCtx;o.save(),o.fillStyle="#fff",o.strokeStyle="#B4B4B4",o.shadowColor="#DADADA",o.shadowBlur=5,o.fillRect(t-3,s-3,6,6),o.fillRect(t+e/2-3,s-3,6,6),o.fillRect(t+e-3,s-3,6,6),o.fillRect(t-3,s+i/2-3,6,6),o.fillRect(t+e-3,s+i/2-3,6,6),o.fillRect(t-3,s+i-3,6,6),o.fillRect(t+e/2-3,s+i-3,6,6),o.fillRect(t+e-3,s+i-3,6,6),o.strokeRect(t-3,s-3,6,6),o.strokeRect(t+e/2-3,s-3,6,6),o.strokeRect(t+e-3,s-3,6,6),o.strokeRect(t-3,s+i/2-3,6,6),o.strokeRect(t+e-3,s+i/2-3,6,6),o.strokeRect(t-3,s+i-3,6,6),o.strokeRect(t+e/2-3,s+i-3,6,6),o.strokeRect(t+e-3,s+i-3,6,6),o.restore()}_drawTitle(t,s,e,i){const o=this.cacheCtx;o.save(),o.font="15px "+this.fontFamily,o.fillStyle="#000",o.textAlign="left",o.textBaseline="top",o.fillText(o.fittingString(t,s-14),e,i-24),o.restore()}_drawIcon(t,s,e,i,o){const r=this.cacheCtx;r.save(),r.beginPath(),r.strokeStyle=o,r.lineWidth=3,r.arc(e+s-6,i-18,9,0,2*Math.PI),r.clip(),r.drawImage(t,e+s-15,i-27,18,18),r.stroke(),r.restore()}renderMarks(){var e;const t=this,s=this.dataHandler.originData;(e=s==null?void 0:s.markDataArray)==null||e.forEach(i=>{const o=i.width,r=i.height,n=Number(i.x),l=Number(i.y),d=i;let c=this.markMap.get(d.id);c?c.updateOptions(d):(c=new Z(this.canvas.cacheCtx,{id:d.id,x:n,y:l,width:o,height:r}),this.markMap.set(d.id,c)),this.canvas.isVisible(c.boundingBox)&&(this.renderElements.push(c),c.draw()),t.focusTarget.has(c)&&t._drawFocus(n,l,o,r)})}zoom(t){const s=t/100;this.canvas.zoom(s),this.update(),this.emit(Ht.Zoom,this.canvas.zoomRate)}getPointBelongBord(t,s){if(s.x===t.x)return"L";if(s.x===t.x+t.width)return"R";if(s.y===t.y)return"T";if(s.y===t.y+t.height)return"B";console.warn("getPointBelongBord未找到匹配边，detail:",t,JSON.parse(JSON.stringify(t)),JSON.parse(JSON.stringify(s)))}resizeNode(t,s,e,i=50){if(["exclusive","inclusive"].includes(e.target.type))return;const o=this,r={x:e.target.x,y:e.target.y,width:e.target.width,height:e.target.height};if(e.targetDirection==="LT"){const l=e.target.width+e.target.x-t,d=e.target.height+e.target.y-s;e.target.updateOptions({x:l<i?e.target.x:t,y:d<i?e.target.y:s,width:l<i?e.target.width:l,height:d<i?e.target.height:d}),n()}else if(e.targetDirection==="TM"){const l=e.target.height+e.target.y-s;e.target.updateOptions({y:l<i?e.target.y:s,height:l<i?e.target.height:l}),n()}else if(e.targetDirection==="RT"){const l=t-e.target.x,d=e.target.height+e.target.y-s;e.target.updateOptions({y:d<i?e.target.y:s,width:l<i?e.target.width:l,height:d<i?e.target.height:d}),n()}else if(e.targetDirection==="LM"){const l=e.target.width+e.target.x-t;e.target.updateOptions({x:l<i?e.target.x:t,width:l<i?e.target.width:l}),n()}else if(e.targetDirection==="RM"){const l=t-e.target.x;e.target.updateOptions({width:l<i?e.target.width:l}),n()}else if(e.targetDirection==="LB"){const l=e.target.width+e.target.x-t,d=s-e.target.y;e.target.updateOptions({x:l<i?e.target.x:t,width:l<i?e.target.width:l,height:d<i?e.target.height:d}),n()}else if(e.targetDirection==="BM"){const l=s-e.target.y;e.target.updateOptions({height:l<i?e.target.height:l}),n()}else if(e.targetDirection==="RB"){const l=t-e.target.x,d=s-e.target.y;e.target.updateOptions({width:l<i?e.target.width:l,height:d<i?e.target.height:d}),n()}e.target.type==="mark"?this.emit(yt.Resize,e.target):this.emit(nt.Resize,e.target);function n(){if(!(e.target instanceof z))return;o.nodeMap.get(e.target.id).updateOptions(e.target);const l=o.nodeRelatedLineMap.get(e.target.id);[...l.from,...l.to].forEach(c=>{const h=c.from!==c.to,y=l.from.has(c)?0:c.pos.length-1;h&&d(c,y),h?o.moveLineForNode(c,e,e.target):o.moveLineForSameNode(c,e)});function d(c,h){c.pos[h].x===r.x?(c.pos[h].x=e.target.x,c.pos[h].y=c.pos[h].y<e.target.y?e.target.y+1:c.pos[h].y>e.target.y+e.target.height?e.target.y+e.target.height-1:c.pos[h].y):c.pos[h].x===r.x+r.width?(c.pos[h].x=e.target.x+e.target.width,c.pos[h].y=c.pos[h].y<e.target.y?e.target.y+1:c.pos[h].y>e.target.y+e.target.height?e.target.y+e.target.height-1:c.pos[h].y):c.pos[h].y===r.y?(c.pos[h].x=c.pos[h].x<=e.target.x?e.target.x+1:c.pos[h].x>=e.target.x+e.target.width?e.target.x+e.target.width-1:c.pos[h].x,c.pos[h].y=e.target.y):c.pos[h].y===r.y+r.height&&(c.pos[h].x=c.pos[h].x<=e.target.x?e.target.x+1:c.pos[h].x>=e.target.x+e.target.width?e.target.x+e.target.width-1:c.pos[h].x,c.pos[h].y=e.target.y+e.target.height)}}}getNodePosFromBoreder(t,s){let e={start:{x:null,y:null},end:{x:null,y:null}};switch(s){case"T":e={start:{x:t.x,y:t.y},end:{x:t.x+t.width,y:t.y}};break;case"B":e={start:{x:t.x,y:t.y+t.height},end:{x:t.x+t.width,y:t.y+t.height}};break;case"L":e={start:{x:t.x,y:t.y},end:{x:t.x,y:t.y+t.height}};break;case"R":e={start:{x:t.x+t.width,y:t.y},end:{x:t.x+t.width,y:t.y+t.height}};break}return e}moveLineForNode(t,s,e){const i=t.pos.length-1,o={x:e.x-s.target.x,y:e.y-s.target.y},r=this.nodeMap.get(t.from),n=this.nodeMap.get(t.to),l=this.getPointBelongBord(r,t.pos[0]),d=this.getPointBelongBord(n,t.pos[i]);(!l||!d)&&this.mergeLines([t]);const c=s.target.id===r.id;if(c?(t.pos[0].x=e.x+(t.pos[0].x-s.target.x),t.pos[0].y=e.y+(t.pos[0].y-s.target.y)):(t.pos[i].x=e.x+(t.pos[i].x-s.target.x),t.pos[i].y=e.y+(t.pos[i].y-s.target.y)),i===1)t.pos.splice(1,0,{x:t.pos[0].x,y:t.pos[0].y},{x:t.pos[0].x,y:t.pos[0].y});else if(i===2)if(l==="R"&&d==="B"){if(this.getNodePosFromBoreder(n,"B").start.y<t.pos[0].y)t.pos[1]={x:t.pos[2].x,y:t.pos[0].y};else{const h=this.getNodePosFromBoreder(r,"R").start.x<this.getNodePosFromBoreder(n,"L").start.x?this.getNodePosFromBoreder(n,"L").start.x:this.getNodePosFromBoreder(n,"R").start.x;t.pos[1]={x:h+(c?0:o.x),y:t.pos[0].y+o.y},t.pos.splice(2)}t.pos[2]&&t.pos[2].x<=t.pos[0].x&&(t.pos[0]={x:t.pos[0].x-1,y:r.y+(c?o.y:0)},t.pos[1]={x:t.pos[2].x,y:t.pos[2].y},t.pos.splice(2))}else l==="B"&&d==="R"?(r.y+r.height<t.pos[1].y?t.pos[1]={x:t.pos[0].x,y:t.pos[2].y}:["exclusive","inclusive"].includes(r.type)?(t.pos[1]={x:t.pos[0].x,y:Math.max(this.getNodePosFromBoreder(r,"B").start.y,this.getNodePosFromBoreder(n,"B").start.y)+20},t.pos[2]={x:n.x+Math.floor(n.width/2)+(c?0:o.x),y:t.pos[1].y},t.pos[3]={x:t.pos[2].x,y:this.getNodePosFromBoreder(n,"B").start.y+(c?0:o.y)}):(t.pos[0]={x:r.x+(s.target.id===r.id?o.x:0),y:t.pos[1].y},t.pos[1]={x:t.pos[2].x,y:t.pos[2].y},t.pos.splice(2)),t.pos[1].x<n.x+n.width&&(t.pos[1].y=n.y+(s.target.id===n.id?o.y:0),t.pos.splice(2))):l==="L"&&d==="B"?(this.getNodePosFromBoreder(n,"B").start.y<t.pos[0].y?t.pos[1]={x:t.pos[2].x,y:t.pos[0].y}:(t.pos[1]={x:n.x+n.width+(s.target.id===n.id?o.x:0),y:t.pos[0].y},t.pos.splice(2)),t.pos[1].x>=s.target.x&&this.getNodePosFromBoreder(n,"B").start.y<this.getNodePosFromBoreder(r,"T").start.y&&(t.pos[0]={x:t.pos[0].x+(c?o.x:0)-1,y:r.y+(c?o.y:0)},t.pos[1]={x:t.pos[2].x,y:t.pos[2].y},t.pos.splice(2))):l==="B"&&d==="L"?(t.pos[1].x=t.pos[0].x,t.pos[1].y=t.pos[2].y,t.pos[1].x>n.x&&(t.pos[1].y=n.y+(s.target.id===n.id?o.y:0),t.pos.splice(2)),t.pos[1].y<t.pos[0].y&&(["exclusive","inclusive"].includes(r.type)?(t.pos[1]={x:t.pos[0].x,y:Math.max(this.getNodePosFromBoreder(r,"B").start.y,this.getNodePosFromBoreder(n,"B").start.y)+20},t.pos[2]={x:n.x+Math.floor(n.width/2)+(c?0:o.x),y:t.pos[1].y},t.pos[3]={x:t.pos[2].x,y:this.getNodePosFromBoreder(n,"B").start.y+(c?0:o.y)}):(t.pos[1].x=this.getNodePosFromBoreder(r,"R").start.x+(s.target.id===r.id?o.x:0),t.pos[1].y=this.getNodePosFromBoreder(r,"B").start.y+(s.target.id===r.id?o.y:0),t.pos.splice(0,1)))):l==="R"&&d==="T"?(t.pos[1].x=t.pos[2].x,t.pos[1].y=t.pos[0].y,t.pos[1].x<t.pos[0].x&&(t.pos[1].y=this.getNodePosFromBoreder(r,"B").start.y+(s.target.id===r.id?o.y:0),t.pos.splice(0,1)),t.pos[2]&&t.pos[1].y>t.pos[2].y&&(["exclusive","inclusive"].includes(n.type)?(t.pos[0]={x:r.x+Math.floor(r.width/2),y:r.y+(c?o.y:0)},t.pos[1]={x:t.pos[0].x,y:t.pos[0].y-20},t.pos[2]={x:t.pos[2].x,y:t.pos[1].y},t.pos[3]={x:t.pos[2].x,y:n.y+(c?0:o.y)}):(t.pos[1].x=n.x+(c?0:o.x),t.pos[1].y=n.y+(c?0:o.y),t.pos.splice(2)))):l==="T"&&d==="R"?(t.pos[1].x=t.pos[0].x,t.pos[1].y=t.pos[2].y,t.pos[1].x<t.pos[2].x&&(t.pos[1].y=this.getNodePosFromBoreder(n,"B").start.y+(s.target.id===n.id?o.y:0),t.pos.splice(2)),t.pos[0].y<t.pos[1].y&&(t.pos[1].x=r.x+(s.target.id===r.id?o.x:0),t.pos[1].y=r.y+(s.target.id===r.id?o.y:0),t.pos.splice(0,1))):l==="T"&&d==="L"?(t.pos[1].x=t.pos[0].x,t.pos[1].y=t.pos[2].y,t.pos[1].x>t.pos[2].x&&(t.pos[1].y=this.getNodePosFromBoreder(n,"B").start.y+(s.target.id===n.id?o.y:0),t.pos.splice(2)),t.pos[1].y>t.pos[0].y&&(t.pos[1].x=this.getNodePosFromBoreder(r,"R").start.x+(s.target.id===r.id?o.x:0),t.pos.splice(0,1))):l==="L"&&d==="T"&&(t.pos[1].x=t.pos[2].x,t.pos[1].y=t.pos[0].y,t.pos[1].y>t.pos[2].y&&(["exclusive","inclusive"].includes(n.type)?(t.pos[0]={x:r.x+Math.floor(r.width/2),y:r.y+(c?o.y:0)},t.pos[1]={x:t.pos[0].x,y:t.pos[0].y-20},t.pos[2]={x:t.pos[2].x,y:t.pos[1].y},t.pos[3]={x:t.pos[2].x,y:n.y+(c?0:o.y)}):(t.pos[1].x=this.getNodePosFromBoreder(n,"R").start.x+(s.target.id===n.id?o.x:0),t.pos.splice(2))),t.pos[1].x>t.pos[0].x&&(t.pos[1].y=this.getNodePosFromBoreder(r,"B").start.y+(s.target.id===r.id?o.y:0),t.pos.splice(0,1)));else if(i===3){const h=Math.floor(Math.abs(t.pos[0].x-t.pos[i].x)/2),y=Math.floor(Math.abs(t.pos[0].y-t.pos[i].y)/2);if(l==="B"&&d==="B")if(this.getNodePosFromBoreder(r,"T").start.y<this.getNodePosFromBoreder(n,"B").start.y)if(this.getNodePosFromBoreder(r,"B").start.y<t.pos[1].y){const p=t.pos[2].y-n.y-n.height+t.pos[3].y;t.pos[1]={x:t.pos[0].x,y:p},t.pos[2]={x:t.pos[3].x,y:p}}else{const p=r.x+r.width>t.pos[3].x?r.x:r.x+r.width,f=t.pos[2].y-n.y-n.height+t.pos[3].y;t.pos[0]={x:p+(s.target.id===r.id?o.x:0),y:f},t.pos[1]={x:t.pos[3].x,y:f},t.pos[2]={x:t.pos[3].x,y:t.pos[3].y},t.pos.splice(3)}else["exclusive","inclusive"].includes(r.type)?(t.pos[1]={x:t.pos[0].x,y:r.y+r.height+20},t.pos[2]={x:t.pos[3].x,y:t.pos[1].y}):(t.pos[0]={x:t.pos[0].x,y:t.pos[0].y-r.height},t.pos[1]={x:t.pos[0].x,y:t.pos[0].y+Math.floor((r.y-n.y-n.height)/2)},t.pos[2]={x:t.pos[3].x,y:t.pos[0].y+Math.floor((r.y-n.y-n.height)/2)});else if(l==="B"&&d==="T")r.y+r.height<n.y?(t.pos[1]={x:t.pos[0].x,y:t.pos[0].y+y},t.pos[2]={x:t.pos[3].x,y:t.pos[0].y+y}):r.y+r.height>=n.y&&(["exclusive","inclusive"].includes(n.type)?(t.pos[0]={x:t.pos[0].x,y:t.pos[0].y-r.height},t.pos[1]={x:t.pos[0].x,y:t.pos[0].y-20},t.pos[2]={x:t.pos[3].x,y:t.pos[1].y}):(t.pos[1]={x:t.pos[0].x,y:n.y+n.height+20},t.pos[2]={x:t.pos[3].x,y:n.y+n.height+20},t.pos[3]={x:t.pos[3].x,y:t.pos[3].y+n.height}));else if(l==="T"&&d==="T")if(["exclusive","inclusive"].includes(r.type)||["exclusive","inclusive"].includes(n.type)){const p=t.pos[1].y+o.y>Math.min(r.y,n.y)-20?Math.min(r.y,n.y)-20:t.pos[1].y+o.y;t.pos[1]={x:t.pos[0].x,y:p},t.pos[2]={x:t.pos[3].x,y:p}}else t.pos[1].y<s.target.y?(t.pos[1]={x:t.pos[0].x,y:t.pos[1].y},t.pos[2]={x:t.pos[3].x,y:t.pos[2].y}):(t.pos[0]={x:t.pos[0].x,y:t.pos[0].y+r.height},t.pos[1]={x:t.pos[0].x,y:Math.max(r.y+r.height,n.y+n.height)+20},t.pos[2]={x:t.pos[3].x,y:Math.max(r.y+r.height,n.y+n.height)+20},t.pos[3]={x:t.pos[3].x,y:t.pos[3].y+n.height});else l==="T"&&d==="B"?r.y>n.y+n.height?(t.pos[1]={x:t.pos[0].x,y:t.pos[0].y-y},t.pos[2]={x:t.pos[3].x,y:t.pos[3].y+y}):r.y<=n.y+n.height&&(console.log("B->B"),t.pos[0]={x:t.pos[0].x,y:t.pos[0].y+r.height},t.pos[1]={x:t.pos[0].x,y:t.pos[0].y+20},t.pos[2]={x:t.pos[3].x,y:t.pos[0].y+20}):l==="L"&&d==="L"?(s.target.id===n.id?(t.pos[2]={x:e.x-(n.x-t.pos[2].x),y:t.pos[3].y},t.pos[1]={x:t.pos[2].x,y:t.pos[0].y}):t.pos[1]={x:t.pos[2].x,y:t.pos[0].y},t.pos[1].x>r.x&&t.pos[1].x<r.x+r.width&&(t.pos.splice(0,1),++t.pos[0].x,t.pos[0].y=(t.pos[1].y<this.getNodePosFromBoreder(r,"T").start.y?this.getNodePosFromBoreder(r,"T").start.y:this.getNodePosFromBoreder(r,"B").start.y)+(s.target.id===r.id?o.y:0))):l==="L"&&d==="R"?r.x>n.x+n.width?(t.pos[1]={x:t.pos[0].x-h,y:t.pos[0].y},t.pos[2]={x:t.pos[1].x,y:t.pos[3].y}):(t.pos[0]={x:t.pos[0].x+r.width,y:t.pos[0].y},t.pos[1]={x:t.pos[0].x+20,y:t.pos[0].y},t.pos[2]={x:t.pos[0].x+20,y:t.pos[3].y}):l==="R"&&d==="L"?r.x+r.width<n.x?(t.pos[1]={x:t.pos[0].x+h,y:t.pos[0].y},t.pos[2]={x:t.pos[0].x+h,y:t.pos[3].y}):(t.pos[1]={x:t.pos[0].x+n.width+20,y:t.pos[0].y},t.pos[2]={x:t.pos[0].x+n.width+20,y:t.pos[3].y},t.pos[3]={x:t.pos[3].x+n.width,y:t.pos[3].y}):l==="R"&&d==="R"&&(s.target.id===n.id?(t.pos[2]={x:e.x-(n.x-t.pos[2].x),y:t.pos[3].y},t.pos[1]={x:t.pos[2].x,y:t.pos[0].y}):t.pos[1]={x:t.pos[2].x,y:t.pos[0].y},t.pos[1].x>r.x&&t.pos[1].x<r.x+r.width&&(t.pos.splice(0,1),--t.pos[0].x,t.pos[0].y=(t.pos[1].y<this.getNodePosFromBoreder(r,"T").start.y?this.getNodePosFromBoreder(r,"T").start.y:this.getNodePosFromBoreder(r,"B").start.y)+(s.target.id===r.id?o.y:0)))}this.emit(et.Move,t)}moveLineForSameNode(t,s){const o=t.pos[1].x-t.pos[0].x,r=t.pos[2].y-t.pos[1].y;t.pos[0]={x:s.target.x+s.target.width,y:s.target.y+s.target.height-20},t.pos[4]={x:s.target.x+s.target.width-20,y:s.target.y+s.target.height},t.pos[1]={x:t.pos[0].x+o,y:t.pos[0].y},t.pos[2]={x:t.pos[1].x,y:t.pos[1].y+r},t.pos[3]={x:t.pos[4].x,y:t.pos[2].y},this.emit(et.Move,t)}moveLineForLine(t,s){var c;const e=t.target.pos,i=e.length-1;let o,r,n=0;if((c=this.dataHandler.originData.nodeDataArray)==null||c.forEach(h=>{h.id===t.target.from&&(o=h,n++),h.id===t.target.to&&(r=h,n++)}),["exclusive","inclusive"].includes(o.type)){if(t.targetLineStartPointIdx===0&&e[t.targetLineStartPointIdx].x===e[t.targetLineStartPointIdx+1].x&&(this.getNodePosFromBoreder(o,"L").start.x>=s.x||this.getNodePosFromBoreder(o,"R").start.x<=s.x)||t.targetLineStartPointIdx===1&&e[t.targetLineStartPointIdx].y===e[t.targetLineStartPointIdx+1].y&&this.getNodePosFromBoreder(o,"B").start.y>=s.y||t.targetLineStartPointIdx===2&&e[t.targetLineStartPointIdx].x===e[t.targetLineStartPointIdx+1].x&&(this.getNodePosFromBoreder(r,"L").start.x>=s.x||this.getNodePosFromBoreder(r,"R").start.x<=s.x))return}else if(["exclusive","inclusive"].includes(r.type)&&(i===1||i===2&&t.targetLineStartPointIdx===1||i===2&&t.targetLineStartPointIdx===0&&this.getNodePosFromBoreder(r,"T").start.y<s.y||i===3&&t.targetLineStartPointIdx===2||i===3&&t.targetLineStartPointIdx===1&&this.getNodePosFromBoreder(r,"T").start.y<s.y||i===3&&t.targetLineStartPointIdx===0&&(this.getNodePosFromBoreder(o,"L").start.x>=s.x||this.getNodePosFromBoreder(o,"R").start.x<=s.x)))return;i===1?e[0].y===e[1].y?(e[0].y=s.y,e[1].y=s.y,(this.getNodePosFromBoreder(o,"T").start.y>s.y||this.getNodePosFromBoreder(o,"B").start.y<s.y)&&(e[0].x=o.x+o.width/2,e.unshift({x:o.x+o.width/2,y:this.getNodePosFromBoreder(o,"T").start.y>s.y?o.y:o.y+o.height})),(this.getNodePosFromBoreder(r,"T").start.y>s.y||this.getNodePosFromBoreder(r,"B").start.y<s.y)&&(e[e.length-1].x=r.x+r.width/2,e.push({x:r.x+r.width/2,y:this.getNodePosFromBoreder(r,"T").start.y>s.y?r.y:r.y+r.height}))):(e[0].x=s.x,e[1].x=s.x,(this.getNodePosFromBoreder(o,"L").start.x>s.x||this.getNodePosFromBoreder(o,"R").start.x<s.x)&&(e[0].y=o.y+o.height/2,e.unshift({x:this.getNodePosFromBoreder(o,"R").start.x<s.x?o.x+o.width:o.x,y:o.y+o.height/2})),(this.getNodePosFromBoreder(r,"L").start.x>s.x||this.getNodePosFromBoreder(r,"R").start.x<s.x)&&(e[e.length-1].y=r.y+r.height/2,e.push({x:this.getNodePosFromBoreder(r,"R").start.x<s.x?r.x+r.width:r.x,y:r.y+r.height/2}))):i===2?e[t.targetLineStartPointIdx].y===e[t.targetLineStartPointIdx+1].y?(e[t.targetLineStartPointIdx].y=s.y,e[t.targetLineStartPointIdx+1].y=s.y,(this.getNodePosFromBoreder(o,"B").start.y<s.y||this.getNodePosFromBoreder(o,"T").start.y>s.y)&&t.targetLineStartPointIdx===0&&(e[t.targetLineStartPointIdx].x=o.x+o.width/2,e.unshift({x:o.x+o.width/2,y:this.getNodePosFromBoreder(o,"T").start.y>s.y?o.y:o.y+o.height})),(this.getNodePosFromBoreder(r,"B").start.y<s.y||this.getNodePosFromBoreder(r,"T").start.y>s.y)&&t.targetLineStartPointIdx===1&&(e[t.targetLineStartPointIdx+1].x=r.x+r.width/2,e.push({x:r.x+r.width/2,y:this.getNodePosFromBoreder(r,"T").start.y>s.y?r.y:r.y+r.height})),t.targetLineStartPointIdx===1&&this.getNodePosFromBoreder(o,"B").start.y>s.y&&this.getNodePosFromBoreder(o,"T").start.y<s.y&&(e.splice(0,1),e[0].x=r.x>o.x?o.x+o.width:o.x),t.targetLineStartPointIdx===0&&this.getNodePosFromBoreder(r,"B").start.y>s.y&&this.getNodePosFromBoreder(r,"T").start.y<s.y&&(e.splice(e.length-1,1),e[e.length-1].x=o.x>r.x?r.x+r.width:r.x)):(e[t.targetLineStartPointIdx].x=s.x,e[t.targetLineStartPointIdx+1].x=s.x,(this.getNodePosFromBoreder(o,"L").start.x>s.x||this.getNodePosFromBoreder(o,"R").start.x<s.x)&&t.targetLineStartPointIdx===0&&(e[t.targetLineStartPointIdx].y=o.y+o.height/2,e.unshift({x:this.getNodePosFromBoreder(o,"L").start.x>s.x?o.x:o.x+o.width,y:o.y+o.height/2})),(this.getNodePosFromBoreder(r,"L").start.x>s.x||this.getNodePosFromBoreder(r,"R").start.x<s.x)&&t.targetLineStartPointIdx===1&&(e[t.targetLineStartPointIdx+1].y=r.y+r.height/2,e.push({x:this.getNodePosFromBoreder(r,"L").start.x>s.x?r.x:r.x+r.width,y:r.y+r.height/2})),t.targetLineStartPointIdx===1&&this.getNodePosFromBoreder(o,"L").start.x<s.x&&this.getNodePosFromBoreder(o,"R").start.x>s.x&&(e.splice(0,1),e[0].y=r.y>o.y?o.y+o.height:o.y),t.targetLineStartPointIdx===0&&this.getNodePosFromBoreder(r,"L").start.x<s.x&&this.getNodePosFromBoreder(r,"R").start.x>s.x&&(e.splice(e.length-1,1),e[e.length-1].y=o.y>r.y?r.y+r.height:r.y)):i===3&&(e[t.targetLineStartPointIdx].y===e[t.targetLineStartPointIdx+1].y?(e[t.targetLineStartPointIdx].y=s.y,e[t.targetLineStartPointIdx+1].y=s.y,t.targetLineStartPointIdx===0?l(e)?e[0].y<this.getNodePosFromBoreder(o,"T").start.y?(e[0]={x:this.getNodePosFromBoreder(o,"T").start.x+o.width/2,y:o.y},e[1]={x:e[0].x,y:s.y},s.y<this.getNodePosFromBoreder(r,"T").start.y||s.y>this.getNodePosFromBoreder(r,"B").start.y?(e[2]={x:this.getNodePosFromBoreder(r,"L").start.x+r.width/2,y:s.y},e[3]={x:e[2].x,y:s.y<this.getNodePosFromBoreder(r,"T").start.y?this.getNodePosFromBoreder(r,"T").start.y:this.getNodePosFromBoreder(r,"B").start.y}):(e[2]={x:e[1].x<this.getNodePosFromBoreder(r,"R").start.x?this.getNodePosFromBoreder(r,"L").start.x:this.getNodePosFromBoreder(r,"R").start.x,y:s.y},e.splice(3))):e[0].y>this.getNodePosFromBoreder(o,"B").start.y&&(e[0]={x:this.getNodePosFromBoreder(o,"T").start.x+o.width/2,y:this.getNodePosFromBoreder(o,"B").start.y},e[1]={x:e[0].x,y:s.y},s.y<this.getNodePosFromBoreder(r,"T").start.y||s.y>this.getNodePosFromBoreder(r,"B").start.y?(e[2]={x:this.getNodePosFromBoreder(r,"L").start.x+r.width/2,y:s.y},e[3]={x:e[2].x,y:s.y<this.getNodePosFromBoreder(r,"T").start.y?this.getNodePosFromBoreder(r,"T").start.y:this.getNodePosFromBoreder(r,"B").start.y}):(e[2]={x:e[1].x<this.getNodePosFromBoreder(r,"R").start.x?this.getNodePosFromBoreder(r,"L").start.x:this.getNodePosFromBoreder(r,"R").start.x,y:s.y},e.splice(3))):s.y<this.getNodePosFromBoreder(o,"T").start.y?(e[0].y=this.getNodePosFromBoreder(o,"T").start.y,e[1].y=this.getNodePosFromBoreder(o,"T").start.y):s.y>this.getNodePosFromBoreder(o,"B").start.y&&(e[0].y=this.getNodePosFromBoreder(o,"B").start.y,e[1].y=this.getNodePosFromBoreder(o,"B").start.y):t.targetLineStartPointIdx===e.length-2?l(e)?e[3].y<this.getNodePosFromBoreder(r,"T").start.y?(e[3]={x:this.getNodePosFromBoreder(r,"T").start.x+r.width/2,y:r.y},e[2]={x:e[3].x,y:s.y},s.y<this.getNodePosFromBoreder(o,"T").start.y||s.y>this.getNodePosFromBoreder(o,"B").start.y?(e[1]={x:this.getNodePosFromBoreder(o,"L").start.x+o.width/2,y:s.y},e[0]={x:e[1].x,y:s.y<this.getNodePosFromBoreder(o,"T").start.y?this.getNodePosFromBoreder(o,"T").start.y:this.getNodePosFromBoreder(o,"B").start.y}):(e[1]={x:e[2].x>this.getNodePosFromBoreder(o,"R").start.x?this.getNodePosFromBoreder(o,"R").start.x:this.getNodePosFromBoreder(o,"L").start.x,y:s.y},e.splice(0,1))):e[3].y>this.getNodePosFromBoreder(r,"B").start.y&&(e[3]={x:this.getNodePosFromBoreder(r,"L").start.x+r.width/2,y:this.getNodePosFromBoreder(r,"B").start.y},e[2]={x:e[3].x,y:s.y},s.y<this.getNodePosFromBoreder(o,"T").start.y||s.y>this.getNodePosFromBoreder(o,"B").start.y?(e[1]={x:this.getNodePosFromBoreder(o,"L").start.x+o.width/2,y:s.y},e[0]={x:e[1].x,y:s.y<this.getNodePosFromBoreder(o,"T").start.y?this.getNodePosFromBoreder(o,"T").start.y:this.getNodePosFromBoreder(o,"B").start.y}):(e[1]={x:e[2].x>this.getNodePosFromBoreder(o,"R").start.x?this.getNodePosFromBoreder(o,"R").start.x:this.getNodePosFromBoreder(o,"L").start.x,y:s.y},e.splice(0,1))):s.y<this.getNodePosFromBoreder(r,"T").start.y?(e[2].y=this.getNodePosFromBoreder(r,"T").start.y,e[3].y=this.getNodePosFromBoreder(r,"T").start.y):s.y>this.getNodePosFromBoreder(r,"B").start.y&&(e[2].y=this.getNodePosFromBoreder(r,"B").start.y,e[3].y=this.getNodePosFromBoreder(r,"B").start.y):(s.y>this.getNodePosFromBoreder(o,"T").start.y&&s.y<this.getNodePosFromBoreder(o,"B").start.y&&(e.splice(0,1),e[0].x=e[1].x<this.getNodePosFromBoreder(o,"L").start.x?this.getNodePosFromBoreder(o,"L").start.x:this.getNodePosFromBoreder(o,"R").start.x),s.y>this.getNodePosFromBoreder(r,"T").start.y&&s.y<this.getNodePosFromBoreder(r,"B").start.y&&(e[e.length-2].x=e[e.length-3].x<this.getNodePosFromBoreder(r,"L").start.x?this.getNodePosFromBoreder(r,"L").start.x:this.getNodePosFromBoreder(r,"R").start.x,e.splice(e.length-1)))):(e[t.targetLineStartPointIdx].x=s.x,e[t.targetLineStartPointIdx+1].x=s.x,t.targetLineStartPointIdx===0?d(e)?e[0].x<this.getNodePosFromBoreder(o,"L").start.x?(e[0]={x:this.getNodePosFromBoreder(o,"L").start.x,y:this.getNodePosFromBoreder(o,"L").start.y+o.height/2},e[1]={x:s.x,y:e[0].y},s.x<this.getNodePosFromBoreder(r,"L").start.x||s.x>this.getNodePosFromBoreder(r,"R").start.x?(e[2]={x:s.x,y:this.getNodePosFromBoreder(r,"T").start.y+r.height/2},e[3]={x:s.x<this.getNodePosFromBoreder(r,"L").start.x?this.getNodePosFromBoreder(r,"L").start.x:this.getNodePosFromBoreder(r,"R").start.x,y:e[2].y}):(e[2]={x:s.x,y:e[1].y<this.getNodePosFromBoreder(r,"T").start.y?this.getNodePosFromBoreder(r,"T").start.y:this.getNodePosFromBoreder(r,"B").start.y},e.splice(3))):e[0].x>this.getNodePosFromBoreder(o,"R").start.x&&(e[0]={x:this.getNodePosFromBoreder(o,"R").start.x,y:this.getNodePosFromBoreder(o,"R").start.y+o.height/2},e[1]={x:s.x,y:e[0].y},s.x<this.getNodePosFromBoreder(r,"L").start.x||s.x>this.getNodePosFromBoreder(r,"R").start.x?(e[2]={x:s.x,y:this.getNodePosFromBoreder(r,"T").start.y+r.height/2},e[3]={x:s.x<this.getNodePosFromBoreder(r,"L").start.x?this.getNodePosFromBoreder(r,"L").start.x:this.getNodePosFromBoreder(r,"R").start.x,y:e[2].y}):(e[2]={x:s.x,y:e[1].y<this.getNodePosFromBoreder(r,"T").start.y?this.getNodePosFromBoreder(r,"T").start.y:this.getNodePosFromBoreder(r,"B").start.y},e.splice(3))):s.x<this.getNodePosFromBoreder(o,"L").start.x?(e[0].x=this.getNodePosFromBoreder(o,"L").start.x+1,e[1].x=this.getNodePosFromBoreder(o,"L").start.x+1):s.x>this.getNodePosFromBoreder(o,"R").start.x&&(e[0].x=this.getNodePosFromBoreder(o,"R").start.x-1,e[1].x=this.getNodePosFromBoreder(o,"R").start.x-1):t.targetLineStartPointIdx===e.length-2?d(e)?e[3].x<this.getNodePosFromBoreder(r,"L").start.x?(e[3]={x:this.getNodePosFromBoreder(r,"L").start.x,y:this.getNodePosFromBoreder(r,"L").start.y+r.height/2},e[2]={x:s.x,y:e[3].y},s.x<this.getNodePosFromBoreder(o,"L").start.x||s.x>this.getNodePosFromBoreder(o,"R").start.x?(e[1]={x:s.x,y:this.getNodePosFromBoreder(o,"T").start.y+o.height/2},e[0]={x:s.x<this.getNodePosFromBoreder(o,"L").start.x?this.getNodePosFromBoreder(o,"L").start.x:this.getNodePosFromBoreder(o,"R").start.x,y:e[1].y}):(e[1]={x:s.x,y:e[2].y>this.getNodePosFromBoreder(o,"B").start.y?this.getNodePosFromBoreder(o,"B").start.y:this.getNodePosFromBoreder(o,"T").start.y},e.splice(0,1))):e[3].x>this.getNodePosFromBoreder(r,"R").start.x&&(e[3]={x:this.getNodePosFromBoreder(r,"R").start.x,y:this.getNodePosFromBoreder(r,"R").start.y+r.height/2},e[2]={x:s.x,y:e[3].y},s.x<this.getNodePosFromBoreder(o,"L").start.x||s.x>this.getNodePosFromBoreder(o,"R").start.x?(e[1]={x:s.x,y:this.getNodePosFromBoreder(o,"T").start.y+o.height/2},e[0]={x:s.x<this.getNodePosFromBoreder(o,"L").start.x?this.getNodePosFromBoreder(o,"L").start.x:this.getNodePosFromBoreder(o,"R").start.x,y:e[1].y}):(e[1]={x:s.x,y:e[2].y>this.getNodePosFromBoreder(o,"B").start.y?this.getNodePosFromBoreder(o,"B").start.y:this.getNodePosFromBoreder(o,"T").start.y},e.splice(0,1))):s.x<this.getNodePosFromBoreder(r,"L").start.x?(e[2].x=this.getNodePosFromBoreder(r,"L").start.x+1,e[3].x=this.getNodePosFromBoreder(r,"L").start.x+1):s.x>this.getNodePosFromBoreder(r,"R").start.x&&(e[2].x=this.getNodePosFromBoreder(r,"R").start.x-1,e[3].x=this.getNodePosFromBoreder(r,"R").start.x-1):(s.x>this.getNodePosFromBoreder(o,"L").start.x&&s.x<this.getNodePosFromBoreder(o,"R").start.x&&(e.splice(0,1),e[0].y=e[1].y<this.getNodePosFromBoreder(o,"T").start.y?this.getNodePosFromBoreder(o,"T").start.y:this.getNodePosFromBoreder(o,"B").start.y),s.x>this.getNodePosFromBoreder(r,"L").start.x&&s.x<this.getNodePosFromBoreder(r,"R").start.x&&(e[e.length-2].y=e[e.length-3].y<this.getNodePosFromBoreder(r,"T").start.y?this.getNodePosFromBoreder(r,"T").start.y:this.getNodePosFromBoreder(r,"B").start.y,e.splice(e.length-1)))),e.length===4&&e[1].x===e[2].x&&e[1].y===e[2].y&&e.splice(1,2));function l(h){let y=0;for(let p=0,f=h.length-1;p<f;p++)y+=Math.abs(h[p].x-h[p+1].x);return y===Math.abs(h[0].x-h[h.length-1].x)}function d(h){let y=0;for(let p=0,f=h.length-1;p<f;p++)y+=Math.abs(h[p].y-h[p+1].y);return y===Math.abs(h[0].y-h[h.length-1].y)}this.emit(et.Move,t.target)}addNode(){this.editType=D.addNote}packNodeInfo(t,s){const{x:e,y:i}=this.transLoc(s);return Object.assign(t,{x:e,y:i+24,width:50,height:50})}getOverlapNode(){const t=this.dataHandler.originData;for(let s=0,e=t.nodeDataArray.length;s<e;s++){const i=Number(t.nodeDataArray[s].width)||100,o=Number(t.nodeDataArray[s].height)||50,r=Number(t.nodeDataArray[s].x),n=Number(t.nodeDataArray[s].y);if(r>r&&r<i+r&&n>n&&n<o+n)return t.nodeDataArray[s]}}transLoc(t){const s=this.canvas.getTranslate(),e=this.canvas.zoomRate,i=Math.floor((t.x+s.x)/e),o=Math.floor((t.y+s.y)/e);return{x:i,y:o}}addLine(t){this.editType=t}addMark(){this.editType=D.addMark}addNote(){this.editType=D.addNote}addRemark(t=""){var s;(s=this.focusTarget)==null||s.forEach(e=>{e.remark=t}),this.update()}changeColor(t,s){var e;(e=this.focusTarget)==null||e.forEach(i=>{i instanceof z?s!=="color"?i[s]=t:console.log("修改的是属性文字颜色, 逻辑待完善."):i instanceof Z?i[s]=t:i instanceof at&&(i.textColor=t)}),this.update()}createLineInfo(t,s){const e=this.chooseTargets,i=this.getNodePosFromBoreder(e[0],"L"),o=this.getNodePosFromBoreder(e[1],"L"),r=[];if(e[0].id===e[1].id)r[0]={x:e[0].x+e[0].width,y:e[0].y+e[0].height-20},r[1]={x:e[0].x+e[0].width+20,y:e[0].y+e[0].height-20},r[2]={x:e[0].x+e[0].width+20,y:e[0].y+e[0].height+20},r[3]={x:e[0].x+e[0].width-20,y:e[0].y+e[0].height+20},r[4]={x:e[0].x+e[0].width-20,y:e[0].y+e[0].height};else if(["exclusive","inclusive"].includes(e[0].type))i.end.y<o.start.y?(r[0]={x:i.end.x+Math.floor(e[0].width/2),y:i.end.y},r[1]={x:r[0].x,y:r[0].y+Math.floor((o.start.y-i.end.y)/2)},r[2]={x:o.start.x+Math.floor(e[1].width/2),y:r[1].y},r[3]={x:r[2].x,y:o.start.y}):(r[0]={x:i.end.x+Math.floor(e[0].width/2),y:i.end.y},r[1]={x:r[0].x,y:Math.max(i.end.y,o.start.y)+20},r[2]={x:o.start.x+Math.floor(e[1].width/2),y:r[1].y},r[3]={x:r[2].x,y:o.end.y});else if(["exclusive","inclusive"].includes(e[1].type))i.end.y<o.start.y?(r[0]={x:i.end.x+Math.floor(e[0].width/2),y:i.end.y},r[1]={x:r[0].x,y:r[0].y+Math.floor((o.start.y-i.end.y)/2)},r[2]={x:o.start.x+Math.floor(e[1].width/2),y:r[1].y},r[3]={x:r[2].x,y:o.start.y}):(r[0]={x:i.end.x+Math.floor(e[0].width/2),y:i.start.y},r[1]={x:r[0].x,y:Math.min(i.end.y,o.start.y)-20},r[2]={x:o.start.x+Math.floor(e[1].width/2),y:r[1].y},r[3]={x:r[2].x,y:o.start.y});else if(this.getNodePosFromBoreder(e[0],"R").start.x<this.getNodePosFromBoreder(e[1],"L").start.x)if((o.start.y-i.end.y)*(o.end.y-i.start.y)<0){const n=Math.max(i.start.y,o.start.y)+Math.abs(Math.floor((Math.min(i.end.y,o.end.y)-Math.max(i.start.y,o.start.y))/2));r[0]={x:this.getNodePosFromBoreder(e[0],"R").start.x,y:n},r[1]={x:this.getNodePosFromBoreder(e[1],"L").start.x,y:n}}else i.start.y>o.end.y?(r[0]={x:i.start.x+Math.floor(e[0].width/2),y:i.start.y},r[1]={x:r[0].x,y:o.start.y+Math.floor(e[1].height/2)},r[2]={x:o.start.x,y:r[1].y}):(r[0]={x:this.getNodePosFromBoreder(e[0],"R").start.x,y:i.start.y+Math.floor(e[0].height/2)},r[1]={x:this.getNodePosFromBoreder(e[1],"L").start.x+Math.floor(e[1].width/2),y:r[0].y},r[2]={x:r[1].x,y:this.getNodePosFromBoreder(e[1],"L").start.y});else if(this.getNodePosFromBoreder(e[0],"L").start.x>this.getNodePosFromBoreder(e[1],"R").start.x)if((o.start.y-i.end.y)*(o.end.y-i.start.y)<0){const n=Math.max(i.start.y,o.start.y)+Math.abs(Math.floor((Math.min(i.end.y,o.end.y)-Math.max(i.start.y,o.start.y))/2));r[0]={x:this.getNodePosFromBoreder(e[0],"L").start.x,y:n},r[1]={x:this.getNodePosFromBoreder(e[1],"R").start.x,y:n}}else i.start.y>o.end.y?(r[0]={x:i.start.x+Math.floor(e[0].width/2),y:i.start.y},r[1]={x:r[0].x,y:o.start.y+Math.floor(e[1].height/2)},r[2]={x:this.getNodePosFromBoreder(e[1],"R").start.x,y:r[1].y}):(r[0]={x:this.getNodePosFromBoreder(e[0],"L").start.x,y:i.start.y+Math.floor(e[0].height/2)},r[1]={x:this.getNodePosFromBoreder(e[1],"L").start.x+Math.floor(e[1].width/2),y:r[0].y},r[2]={x:r[1].x,y:this.getNodePosFromBoreder(e[1],"L").start.y});else if(i.start.y>o.end.y){const n=Math.max(i.start.x,o.start.x),l=Math.min(this.getNodePosFromBoreder(e[0],"R").start.x,this.getNodePosFromBoreder(e[1],"R").start.x),d=n+Math.floor((l-n)/2);r[0]={x:d,y:i.start.y},r[1]={x:d,y:o.end.y}}else{const n=Math.max(i.start.x,o.start.x),l=Math.min(this.getNodePosFromBoreder(e[0],"R").start.x,this.getNodePosFromBoreder(e[1],"R").start.x),d=n+Math.floor((l-n)/2);r[0]={x:d,y:i.end.y},r[1]={x:d,y:o.start.y}}if(r.length){const n={};return s?(s.pos=r,Object.assign(n,s)):Object.assign(n,{id:this.createKey(),from:e[0].id,to:e[1].id,pos:r,type:t}),n}else console.error("createLine方法错误：未生成对应关键点坐标")}createLine(t,s){const e=this.createLineInfo(t,s);["primaryKey","foreignKey"].includes(t)&&this.externalFn.addLine(e)}mergeLine(t,s){const e=this.createLineInfo(t,s);return Object.assign(s,e)}createBranchLine(){const t=[].concat(this.chooseTargets),s=this.getNodePosFromBoreder(t[0],"L"),e=this.getNodePosFromBoreder(t[1],"L");if(["inclusive","exclusive"].includes(t[1].type))this.$message({message:"未将对象引用设置到对象的实例。",type:"error",showClose:!0});else if(["inclusive","exclusive"].includes(t[0].type)){const i=this.createLine("fromFilterPrimaryKey");this.externalFn.addFilter({fromFilter:i})}else{const i=s.end.y+50<e.start.y?{x:s.start.x+Math.floor(t[0].width/2)-20,y:s.end.y+Math.floor((e.start.y-s.end.y)/2)-10}:{x:e.start.x+Math.floor(t[1].width/2)-20,y:Math.min(s.start.y,e.start.y)-50},o={id:this.createKey(),x:i.x,y:i.y,width:40,height:20,type:"exclusive",fromKey:t[0].id};this.chooseTargets=[t[0],o];const r=this.createLine("toFilter");this.chooseTargets=[o,t[1]];const n=this.createLine("fromFilterPrimaryKey");this.externalFn.addFilter({filter:o,toFilter:r,fromFilter:n}),this.chooseTargets=[]}}getNodeWithKey(t){for(const s of this.dataHandler.originData.nodeDataArray)if(s.id===t)return s}createLines(t){for(const s of t){const e=this.getNodeWithKey(s.from),i=this.getNodeWithKey(s.to);e&&i&&(this.chooseTargets=[e,i],this.createLine(s.type,s))}this.chooseTargets=[],this.update()}mergeLines(t){const s=[];for(const e of t){const i=this.getNodeWithKey(e.from),o=this.getNodeWithKey(e.to);i&&o&&(this.chooseTargets=[i,o],s.push(this.mergeLine(e.type,e)))}return this.chooseTargets=[],s}createKey(){return+new Date+""+Math.floor(Math.random()*1e5)}$message(t){this.externalFn.$message&&this.externalFn.$message(t)}}const tt={nodeDataArray:[{id:"Entity1",x:100,y:100,width:100,height:100,bgC:"#FF8080",bdC:"red",name:"Entity1",physicalTables:!0,quotePrimaryKey:!0,attributes:[{name:"attr1",id:"1",primaryKey:!0,foreignKey:!0,type:"INT",icons:[{bgC:"#FEFF80",color:"#8080FF",text:"S"},{text:"L",bdC:"green"}]},{name:"attr2",id:"2",type:"DATE",primaryKey:!0},{name:"属性名3",id:"3",primaryKey:!0,type:"char",children:[{name:"属性名3-1",id:"3-1",primaryKey:!0,foreignKey:!0,children:[{name:"属性名3-1-1",primaryKey:!0,foreignKey:!0,children:[{name:"属性名3-1-1-1",primaryKey:!0,foreignKey:!0}],icons:[{text:"A",bdC:"green"}]}]},{name:"属性名3-2",primaryKey:!0,foreignKey:!0},{name:"属性名3-3",primaryKey:!0,foreignKey:!0}]},{name:"attr4",primaryKey:!1,foreignKey:!0,icons:[{bgC:"#FEFF80",color:"#8080FF",text:"S"},{text:"标"}]},{name:"attr5",primaryKey:!1},{name:"attr6",primaryKey:!1,icons:[{text:"A",bdC:"green"}]}]},{id:"Entity2",x:400,y:100,width:50,height:100,bgC:"#8080FF",name:"Entity2",quotePrimaryKey:!0,attributes:[{name:"属性名1",primaryKey:!0,foreignKey:!1},{name:"属性名2",primaryKey:!0},{name:"属性名3",primaryKey:!0}]},{id:"Entity3",x:100,y:400,width:50,height:100,bgC:"#FFFF80",name:"Entity3",attributes:[{name:"属性名1",primaryKey:!1,foreignKey:!1},{name:"属性名2",primaryKey:!1}]},{id:"Entity4",x:100,y:250,width:40,height:20,type:"inclusive"},{id:"Entity5",x:705,y:92,width:260,height:100,name:"Entity5",type:"inside"},{id:"Entity6",x:600,y:280,width:260,height:100,name:"Entity6",type:"explain",attributes:[{label:"说明",content:"表示与银行有利害关系，以及银行希望保留其信息"},{label:"示例",content:"个人 组织 客户"},{label:"所属部门",content:"数据研究院"},{label:"负责人",content:"杨中旭"}]},{id:"Entity7",x:2999,y:2999,width:260,height:100,name:"Entity7",type:"inside"},{id:"Entity8",x:-2999,y:-2999,width:260,height:100,name:"Entity8",type:"inside"},{id:"Entity9",x:500,y:500,width:260,height:100,name:"Entity9",type:"inside"},{id:"Entity10",x:-500,y:-500,width:260,height:100,name:"Entity10",type:"inside"},{id:"Entity11",x:-300,y:-300,width:260,height:100,name:"Entity11",type:"inside"},{id:"Entity12",x:-200,y:-200,width:260,height:100,name:"Entity12",type:"inside"}],linkDataArray:[{id:1,from:"Entity1",to:"Entity2",pos:[{x:200,y:125},{x:400,y:125}],type:"primaryKey",numLineTypes:1,remark:"主键"},{id:3,from:"Entity2",to:"Entity3",pos:[{x:400,y:150},{x:300,y:150},{x:300,y:450},{x:150,y:450}],type:"foreignKey",numLineTypes:1},{id:4,from:"Entity1",to:"Entity4",pos:[{x:120,y:200},{x:120,y:250}],type:"toFilter",numLineTypes:2},{id:5,from:"Entity4",to:"Entity3",pos:[{x:120,y:270},{x:120,y:400}],type:"fromFilter",numLineTypes:4},{id:6,from:"Entity5",to:"Entity6",pos:[{x:782,y:192},{x:782,y:280}],type:"arrow",numLineTypes:1,remark:"来自"},{id:7,from:"Entity9",to:"Entity10",pos:[{x:782,y:192},{x:782,y:280}],type:"arrow",numLineTypes:1,remark:"来自"},{id:8,from:"Entity2",to:"Entity9",pos:[{x:782,y:192},{x:782,y:280}],type:"arrow",numLineTypes:1,remark:"来自"},{id:9,from:"Entity2",to:"Entity1",pos:[{x:782,y:192},{x:782,y:280}],type:"arrow",numLineTypes:1,remark:"来自"},{id:10,from:"Entity9",to:"Entity11",pos:[{x:782,y:192},{x:782,y:280}],type:"arrow",numLineTypes:1,remark:"来自"},{id:11,from:"Entity2",to:"Entity12",pos:[{x:782,y:192},{x:782,y:280}],type:"arrow",numLineTypes:1,remark:"来自"}],markDataArray:[{id:"Mark1",x:50,y:50,width:500,height:500,name:"Mark1"}],noteDataArray:[{id:"157837643603536658",x:525,y:408,text:"啦啦啦啦啦111",type:"note",color:"#0000ff"}]},dn=[[{icon:"",value:"copy",label:"复制"},{icon:"",value:"extend-copy",label:"继承复制"},{icon:"",value:"parse",label:"粘贴"}],[{icon:"",value:"redo",label:"撤销"}],[{icon:"",value:"parent",label:"显示父级关联",children:[{icon:"",value:"level-2",label:"显示2级"},{icon:"",value:"level-all",label:"显示全部"},{icon:"",value:"level-1",label:"显示1级"}]}],[{icon:"",value:"auto-size",label:"自适应大小"},{icon:"",value:"auto-layout",label:"自动排布"}],[{icon:"",value:"style",label:"展示风格",children:[{icon:"",value:"brief",label:"概要"},{icon:"",value:"easy",label:"简单"},{icon:"",value:"normal",label:"常规"},{icon:"",value:"detail",label:"详细"}]}],{icon:"",value:"delete",label:"删除"}],W=""+new URL("symbol-defs-01fb22be.svg",import.meta.url).href,cn={class:"erg"},un={class:"toobar"},yn=["xlink:href"],gn=["xlink:href"],pn=["xlink:href"],xn=["xlink:href"],fn=["xlink:href"],mn=["xlink:href"],vn=["xlink:href"],wn=["xlink:href"],bn=["xlink:href"],Bn=["xlink:href"],Pn=["xlink:href"],Fn=["xlink:href"],Nn=["xlink:href"],Mn=F("div",{id:"canvas",class:"canvas"},null,-1),Us=Y({__name:"Erg",props:{useThumbnail:{type:Boolean,default:!0},useRightMenu:{type:Boolean,default:!0},useAttrFocus:{type:Boolean,default:!0},editable:{default:"edit"}},setup(a){const t=a;let s;const e=gs({scale:100,bgC:"",bdC:"",color:"",lock:"edit"}),i=()=>{s=new hn({el:document.getElementById("canvas"),fontFamily:"-apple-system, Noto Sans, Helvetica Neue, Helvetica, Nimbus Sans L, Arial, Liberation Sans, PingFang SC, Hiragino Sans GB, Noto Sans CJK SC, Source Han Sans SC, Source Han Sans CN, Microsoft YaHei, Wenquanyi Micro Hei, WenQuanYi Zen Hei, ST Heiti, SimHei, WenQuanYi Zen Hei Sharp, sans-serif",editable:e.lock,externalFn:{addNode:function(g){const v=prompt("请输入表名：");v&&(g.name=v,tt.nodeDataArray.push(g))},delNode:function(g){console.log(g)},addLine:function(g){console.log("添加线了"),g.numLineTypes=2,tt.linkDataArray.push(g)},delLine:function(g){console.log(g)},addFilter:function(g){g.filter&&tt.nodeDataArray.push(g.filter),g.toFilter&&tt.linkDataArray.push(g.toFilter),tt.linkDataArray.push(g.fromFilter)},delFilter:function(g){console.log(g)},addMark:function(g){tt.markDataArray.push(g),markMap.set(g.id,g)},delMark:function(g){console.log(g)},addNote:function(g){const v=prompt("请输入备注内容：");v&&(g.text=v,tt.noteDataArray.push(g))},delNote:function(g){console.log(g)},$message:function(g){console.log(g.message)},handleCopy(g,v){return console.log(g,v),!0},handlePaste(g){tt.nodeDataArray.push(...g)},handleContextMenu(g,v){switch(console.log("菜单点击触发：",g,v),v){case"remark":const w=prompt("请输入备注内容：");if(!w)return;s.addRemark(w);break}}},useThumbnail:t.useThumbnail,useAttrFocus:t.useAttrFocus,useRightMenu:t.useRightMenu,rightMenu:dn}),s.update(tt),s.on("contextmenu:show",g=>{console.log(g,"info"),s.updateConfig({rightMenu:[{label:"test",value:"11"}]})})},o=()=>{s.destroy()},r=g=>{e.scale>20&&(e.scale+=g),s.zoom(e.scale)},n=()=>{s.addNode({id:s.createKey(),attributes:[]})},l=g=>{s.addLine(g)},d=()=>{s.addMark()},c=()=>{s.addNote()},h=(g,v)=>{s.changeColor(g,v)},y=()=>{e.lock=e.lock===1?2:1,s.setEditable(e.lock)},p=()=>{s.copy()},f=()=>{const g=[{from:0,to:1,pos:[{x:200,y:125},{x:400,y:125}],type:"primaryKey",numLineTypes:1}];s.createLines(g)},x=()=>s.updateLayout();return Mt(()=>{i()}),ir(o),(g,v)=>(b(),T("div",cn,[F("div",un,[S(u(H),{size:"small",circle:"",title:"新增实体",onClick:n},{icon:L(()=>[(b(),T("svg",null,[F("use",{"xlink:href":`${u(W)}#icon-tool-add`},null,8,yn)]))]),_:1}),S(u(H),{size:"small",circle:"",title:"复制",onClick:p},{icon:L(()=>[(b(),T("svg",null,[F("use",{"xlink:href":`${u(W)}#copy`},null,8,gn)]))]),_:1}),S(u(H),{size:"small",circle:"",title:"新增主键",onClick:v[0]||(v[0]=w=>l("primaryKey"))},{icon:L(()=>[(b(),T("svg",null,[F("use",{"xlink:href":`${u(W)}#icon-tool-primary`},null,8,pn)]))]),_:1}),S(u(H),{size:"small",circle:"",title:"新增非主键",onClick:v[1]||(v[1]=w=>l("foreignKey"))},{icon:L(()=>[(b(),T("svg",null,[F("use",{"xlink:href":`${u(W)}#icon-tool-foreign`},null,8,xn)]))]),_:1}),S(u(H),{size:"small",circle:"",title:"新增过滤器",onClick:v[2]||(v[2]=w=>l("branchLine"))},{icon:L(()=>[(b(),T("svg",null,[F("use",{"xlink:href":`${u(W)}#icon-tool-subtype`},null,8,fn)]))]),_:1}),S(u(Qt),{direction:"vertical"}),S(u(H),{size:"small",circle:"",title:"新增框",onClick:d},{icon:L(()=>[(b(),T("svg",null,[F("use",{"xlink:href":`${u(W)}#icon-tool-square`},null,8,mn)]))]),_:1}),S(u(H),{size:"small",circle:"",title:"新增备注",onClick:c},{icon:L(()=>[(b(),T("svg",null,[F("use",{"xlink:href":`${u(W)}#icon-tool-text`},null,8,vn)]))]),_:1}),S(u(Qt),{direction:"vertical"}),e.lock===1?(b(),K(u(H),{key:0,size:"small",circle:"",title:"只读",onClick:y},{icon:L(()=>[(b(),T("svg",null,[F("use",{"xlink:href":`${u(W)}#lock`},null,8,wn)]))]),_:1})):(b(),K(u(H),{key:1,size:"small",circle:"",title:"编辑",onClick:y},{icon:L(()=>[(b(),T("svg",null,[F("use",{"xlink:href":`${u(W)}#unlock`},null,8,bn)]))]),_:1})),S(u(H),{size:"small",circle:"",title:"批量创建连线",onClick:f},{icon:L(()=>[(b(),T("svg",null,[F("use",{"xlink:href":`${u(W)}#copy`},null,8,Bn)]))]),_:1}),S(u(H),{size:"small",circle:"",title:"放大",onClick:v[3]||(v[3]=w=>r(20))},{icon:L(()=>[(b(),T("svg",null,[F("use",{"xlink:href":`${u(W)}#plus-circle`},null,8,Pn)]))]),_:1}),S(u(H),{size:"small",circle:"",title:"缩小",onClick:v[4]||(v[4]=w=>r(-20))},{icon:L(()=>[(b(),T("svg",null,[F("use",{"xlink:href":`${u(W)}#minus-circle`},null,8,Fn)]))]),_:1}),S(u(Qt),{direction:"vertical"}),S(u(pe),{modelValue:e.bgC,"onUpdate:modelValue":v[5]||(v[5]=w=>e.bgC=w),size:"small",onChange:v[6]||(v[6]=w=>h(w,"bgC"))},null,8,["modelValue"]),S(u(pe),{modelValue:e.bdC,"onUpdate:modelValue":v[7]||(v[7]=w=>e.bdC=w),size:"small",onChange:v[8]||(v[8]=w=>h(w,"bdC"))},null,8,["modelValue"]),S(u(pe),{modelValue:e.color,"onUpdate:modelValue":v[9]||(v[9]=w=>e.color=w),size:"small",onChange:v[10]||(v[10]=w=>h(w,"color"))},null,8,["modelValue"]),S(u(Qt),{direction:"vertical"}),S(u(H),{size:"small",circle:"",title:"自动布局",onClick:v[11]||(v[11]=w=>x())},{icon:L(()=>[(b(),T("svg",null,[F("use",{"xlink:href":`${u(W)}#layout-o`},null,8,Nn)]))]),_:1})]),Mn]))}});Us.__docgenInfo={exportName:"default",displayName:"Erg",description:"",tags:{},props:[{name:"useThumbnail",required:!0,type:{name:"boolean"},defaultValue:{func:!1,value:"true"}},{name:"useRightMenu",required:!0,type:{name:"boolean"},defaultValue:{func:!1,value:"true"}},{name:"useAttrFocus",required:!0,type:{name:"boolean"},defaultValue:{func:!1,value:"true"}},{name:"editable",required:!0,type:{name:"string"},defaultValue:{func:!1,value:"'edit'"}}],sourceFiles:["/home/runner/work/renderer2d/renderer2d/stories/erg/Erg.vue"]};const Rn={title:"Example/Erg",component:Us,argTypes:{editable:{control:"select",options:[1,2,3]}},args:{useThumbnail:!0,useRightMenu:!0,useAttrFocus:!0,editable:!0}},kt={};var ds,cs,us;kt.parameters={...kt.parameters,docs:{...(ds=kt.parameters)==null?void 0:ds.docs,source:{originalSource:"{}",...(us=(cs=kt.parameters)==null?void 0:cs.docs)==null?void 0:us.source}}};const En=["Primary"];export{kt as Primary,En as __namedExportsOrder,Rn as default};
//# sourceMappingURL=Erg.stories-cef6f76f.js.map
